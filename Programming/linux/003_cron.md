#linux #tools #cron

**Cron** - —ç—Ç–æ –¥–µ–º–æ–Ω-–ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á –≤ Unix-–ø–æ–¥–æ–±–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –∏ —Å–∫—Ä–∏–ø—Ç—ã –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é. –°–æ—Å—Ç–æ–∏—Ç –∏–∑ –¥–≤—É—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:
* **crond** - –¥–µ–º–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Ñ–æ–Ω–µ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
* **crontab** - —Ç–∞–±–ª–∏—Ü–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
---
#### üîπ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É–∂–±–æ–π cron

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞  
sudo systemctl status cron  
  
# –ó–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã  
sudo systemctl start cron  
  
# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–ª—É–∂–±—ã  
sudo systemctl stop cron  
  
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã  
sudo systemctl restart cron  
  
# –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã  
sudo systemctl enable cron
```
---
#### üîπ –†–∞–±–æ—Ç–∞ —Å crontab

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á  
crontab -l  
  
# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ crontab  
crontab -e  
  
# –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á  
crontab -r 

# –†–∞–±–æ—Ç–∞ —Å crontab –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Ç—Ä–µ–±—É–µ—Ç sudo)  
sudo crontab -u username -l  
sudo crontab -u username -e 
```
---
#### üîπ –°–∏–Ω—Ç–∞–∫—Å–∏—Å crontab

```

* * * * * –∫–æ–º–∞–Ω–¥–∞  
‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îÇ  
‚îÇ ‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ –¥–µ–Ω—å –Ω–µ–¥–µ–ª–∏ (0-7, –≥–¥–µ 0 –∏ 7 = –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ)  
‚îÇ ‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –º–µ—Å—è—Ü (1-12)  
‚îÇ ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –¥–µ–Ω—å –º–µ—Å—è—Ü–∞ (1-31)  
‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ —á–∞—Å (0-23)  
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ –º–∏–Ω—É—Ç–∞ (0-59)

```

######  üî∏ –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
- ***** - –ª—é–±–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
- **,** - —Å–ø–∏—Å–æ–∫ –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1,3,5`)
- **-** - –¥–∏–∞–ø–∞–∑–æ–Ω –∑–Ω–∞—á–µ–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, `1-5`)
- **/** - –∏–Ω—Ç–µ—Ä–≤–∞–ª (–Ω–∞–ø—Ä–∏–º–µ—Ä, `*/15` –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç)
- **@** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã
######  üî∏  –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–∞–∫—Ä–æ—Å—ã
@yearly   # –∏–ª–∏ @annually - —Ä–∞–∑ –≤ –≥–æ–¥ (0 0 1 1 *)  
@monthly  # —Ä–∞–∑ –≤ –º–µ—Å—è—Ü (0 0 1 * *)  
@weekly   # —Ä–∞–∑ –≤ –Ω–µ–¥–µ–ª—é (0 0 * * 0)  
@daily    # –∏–ª–∏ @midnight - —Ä–∞–∑ –≤ –¥–µ–Ω—å (0 0 * * *)  
@hourly   # –∫–∞–∂–¥—ã–π —á–∞—Å (0 * * * *)  
@reboot   # –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã

#### üîπ  –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
---
######  üî∏  –ë–∞–∑–æ–≤—ã–µ –ø—Ä–∏–º–µ—Ä—ã
```bash
# –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É  
* * * * * /path/to/script.sh  
  
# –ö–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç  
*/5 * * * * /path/to/script.sh  
  
# –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 2:30  
30 2 * * * /path/to/script.sh  
  
# –ö–∞–∂–¥—ã–π –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫ –≤ 9:00  
0 9 * * 1 /path/to/script.sh  
  
# –ü–µ—Ä–≤–æ–≥–æ —á–∏—Å–ª–∞ –∫–∞–∂–¥–æ–≥–æ –º–µ—Å—è—Ü–∞ –≤ 6:00  
0 6 1 * * /path/to/script.sh  
  
# –†–∞–±–æ—á–∏–µ –¥–Ω–∏ –≤ 8:30  
30 8 * * 1-5 /path/to/script.sh  
  
# –ö–∞–∂–¥—ã–µ 2 —á–∞—Å–∞  
0 */2 * * * /path/to/script.sh
```

######  üî∏  –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã
```bash
# –ë—ç–∫–∞–ø –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00, –∫—Ä–æ–º–µ –≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å—è  
0 3 * * 1-6 /usr/local/bin/backup.sh  
  
# –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤ –∫–∞–∂–¥—É—é –Ω–µ–¥–µ–ª—é  
0 0 * * 0 find /var/log -name "*.log" -mtime +7 -delete  
  
# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å–ª—É–∂–±—ã –∫–∞–∂–¥—ã–µ 6 —á–∞—Å–æ–≤  
0 */6 * * * sudo systemctl restart myservice  
  
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–∏—Å–∫–æ–≤–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –∫–∞–∂–¥—ã–µ 15 –º–∏–Ω—É—Ç  
*/15 * * * * df -h | mail -s "Disk Usage" admin@example.com

# –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É –≤ —Ñ–∞–π–ª –±—É–¥–µ—Ç –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –±–æ–ª—å—à–µ–µ –≤—Å–µ—Ö —Å–∂–∏—Ä–∞—é—â–∏–π –ø–∞–º—è—Ç—å
*/1 * * * * ps -e -o pid,vsz,comm= | sort -n -k 2 | tail -n1 >> /home/romaxa/top-process.txt

# –∑–∞–ø—É—Å–∫ schedule –¥–ª—è laravel
* * * * * cd /home/wzdev/web/arma-motors.wezom.agency/public_html && php80 artisan schedule:run >> /dev/null 2>&1
```

######  üî∏  –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ crontab
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ –Ω–∞—á–∞–ª–µ crontab  
SHELL=/bin/bash  
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin  
MAILTO=admin@example.com  
HOME=/home/user

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö  
0 2 * * * $HOME/scripts/backup.sh
```
---
#### üîπ  –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ—Ç–ª–∞–¥–∫–∞

######  üî∏  –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ cron
```bash
# –û—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥ cron  
sudo tail -f /var/log/cron  
  
# –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞—Ö  
sudo tail -f /var/log/syslog | grep CRON  
  
# –ñ—É—Ä–Ω–∞–ª systemd  
sudo journalctl -u cron -f
```

######  üî∏ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—ã–≤–æ–¥–∞
```bash
# –û—Ç–ø—Ä–∞–≤–∫–∞ –≤—ã–≤–æ–¥–∞ –Ω–∞ email (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)  
0 2 * * * /path/to/script.sh  
  
# –ü–æ–¥–∞–≤–ª–µ–Ω–∏–µ –≤—Å–µ–≥–æ –≤—ã–≤–æ–¥–∞  
0 2 * * * /path/to/script.sh > /dev/null 2>&1  
  
# –ó–∞–ø–∏—Å—å –≤ –ª–æ–≥-—Ñ–∞–π–ª  
0 2 * * * /path/to/script.sh >> /var/log/myscript.log 2>&1  
  
# –û—Ç–ø—Ä–∞–≤–∫–∞ —Ç–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ –Ω–∞ email  
0 2 * * * /path/to/script.sh > /dev/null
```
---
#### üîπ  –°–∏—Å—Ç–µ–º–Ω—ã–µ crontab —Ñ–∞–π–ª—ã

######  üî∏ –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤
```bash
/etc/crontab                # –°–∏—Å—Ç–µ–º–Ω—ã–π crontab  
/etc/cron.d/                # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–¥–∞—á–∏  
/etc/cron.daily/            # –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–µ –∑–∞–¥–∞—á–∏  
/etc/cron.weekly/           # –ï–∂–µ–Ω–µ–¥–µ–ª—å–Ω—ã–µ –∑–∞–¥–∞—á–∏  
/etc/cron.monthly/          # –ï–∂–µ–º–µ—Å—è—á–Ω—ã–µ –∑–∞–¥–∞—á–∏  
/etc/cron.hourly/           # –ï–∂–µ—á–∞—Å–Ω—ã–µ –∑–∞–¥–∞—á–∏  
/var/spool/cron/crontabs/   # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ crontab
```

###### üî∏ –ü—Ä–∏–º–µ—Ä —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ crontab
```bash
# /etc/crontab  
SHELL=/bin/sh  
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin  
  
# m h dom mon dow user  command  
17 *    * * *   root    cd / && run-parts --report /etc/cron.hourly  
25 6    * * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.daily )  
47 6    * * 7   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.weekly )  
52 6    1 * *   root    test -x /usr/sbin/anacron || ( cd / && run-parts --report /etc/cron.monthly )
```
---
#### üîπ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

###### üî∏ –ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞
```bash
# –†–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏  
/etc/cron.allow  
  
# –ó–∞–ø—Ä–µ—â–µ–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏  
/etc/cron.deny  
  
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞  
ls -la /usr/bin/crontab
```

###### üî∏ –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
* **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ –ø—É—Ç–∏** –∫ –∫–æ–º–∞–Ω–¥–∞–º –∏ —Ñ–∞–π–ª–∞–º
* **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é PATH**
* **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** –∫ —Å–∫—Ä–∏–ø—Ç–∞–º
* **–õ–æ–≥–∏—Ä—É–π—Ç–µ –¥–µ–π—Å—Ç–≤–∏—è** –¥–ª—è –∞—É–¥–∏—Ç–∞
* **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ —Å–∫—Ä–∏–ø—Ç—ã** –ø–µ—Ä–µ–¥ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ–º –≤ cron
---
#### üîπ –ü–æ–ª–µ–∑–Ω—ã–µ —Å–æ–≤–µ—Ç—ã

###### üî∏ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ cron –∑–∞–¥–∞—á
```bash
# –ó–∞–ø—É—Å–∫ –∫–æ–º–∞–Ω–¥—ã –æ—Ç –∏–º–µ–Ω–∏ cron  
sudo -u www-data crontab -l  
  
# –ò–º–∏—Ç–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è cron  
env -i bash -c 'your-command'
```

###### üî∏ –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –∑–æ–Ω—ã –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∑–∞–¥–∞—á–∏  
CRON_TZ=Europe/London  
0 9 * * * /path/to/script.sh
```

###### üî∏ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
```bash
# –ü—Ä–æ—Å—Ç–æ–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞  
0 2 * * * /path/to/backup.sh && echo "Backup completed" | mail -s "Success" admin@example.com || echo "Backup failed" | mail -s "Error" admin@example.com

```

---