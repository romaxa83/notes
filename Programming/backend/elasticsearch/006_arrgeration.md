
https://alexeykalina.github.io/technologies/elasticsearh-facets.html

==ะะะะะะะฆะะฏ== ะธัะฟะพะปัะทัะตััั ะดะปั ะฐะฝะฐะปะธะทะฐ ะดะฐะฝะฝัั, ะธะผะตะตั ัะปะตะดัััะธะน ะฒะธะด - ัะปะตะผะตะฝั `aggs` ะดะพะปะถะตะฝ ัะพะดะตัะถะฐัั ัะฐะบัะธัะตัะบะธะน ะทะฐะฟัะพั ะฐะณัะตะณะฐัะธะธ ะตัะปะธ ะฝะต ัะบะฐะทะฐะฝ ัะปะตะผะตะฝั `query` (ะผั ะผะพะถะตะผ ััะธัะฐัั ะตะณะพ ัะฐะฒะฝัะผ ะทะฐะฟัะพัั `match_all`, ะตัะปะธ ะฝะตั ะธะฝะพะณะพ ะทะฐะฟัะพัะฐ). ะัะปะธ ะผั ัะพัะธะผ ะพะณัะฐะฝะธัะธัั ะบะพะฝัะตะบัั ะฐะณัะตะณะฐัะธะธ, ะฝะตะพะฑัะพะดะธะผะพ ัะบะฐะทะฐัั ัะปะตะผะตะฝั `query`. ะญะปะตะผะตะฝั `size` ัะบะฐะทัะฒะฐะตั, ัะบะพะปัะบะพ ัะพะพัะฒะตัััะฒะธะน ะฟะพะธัะบะฐ ะดะพะปะถะฝะพ ะฑััั ะฒะพะทะฒัะฐัะตะฝะพ ะฒ ะพัะฒะตัะต(`default=10`)

```
POST /<index_name>/<type_name>/_search
{
ยย"aggs": {
ยยยย... ัะธะฟ ะฐะณัะตะณะฐัะธะธ ...
ยย},
ยย"query": { ... ัะธะฟ ะทะฐะฟัะพัะฐ ... }, // ะฝะตะพะฑัะทะฐัะตะปัะฝะฐั ัะฐััั ะทะฐะฟัะพัะฐ
ยย"size": 0ยยยยยยยยยยยยยยยยยยยยยยยยย// ะพะฑััะฝะพ ัะบะฐะทัะฒะฐะตััั ัะฐะทะผะตั 0
}
```

#### ๐น ะขะะะซ ะะะะะะะฆะะ

- ัะตะณะผะตะฝัะฐัะฝัะต ะฐะณัะตะณะฐัะธะธ - ัะฐะทะดะตะปััั ะดะฐะฝะฝัะต ะทะฐะฟัะพัะฐ (ะพะฑะพะทะฝะฐัะตะฝะฝัะต ะบะพะฝัะตะบััะพะผ query) ะฝะฐ ัะฐะทะปะธัะฝัะต ัะตะณะผะตะฝัั, ะธะดะตะฝัะธัะธัะธััะตะผัะต ัะตะณะผะตะฝัะฐัะฝัะผ ะบะปััะพะผ. ะขะฐะบะพะน ัะธะฟ ะฐะณัะตะณะฐัะธะธ ะพัะตะฝะธะฒะฐะตั ะดะพะบัะผะตะฝั ะฒ ะบะพะฝัะตะบััะต ะฟััะตะผ ะฒััะธัะปะตะฝะธั, ะฒ ะบะฐะบะพะน ะธะผะตะฝะฝะพ ัะตะณะผะตะฝั ะพะฝ ะฟะพะฟะฐะดะฐะตั. ะ ัะตะทัะปััะฐัะต ะผั ะฟะพะปััะฐะตะผ ะฝะฐะฑะพั ะพะฟัะตะดะตะปะตะฝะฝัั ัะตะณะผะตะฝัะพะฒ ัะพ ัะฒะพะธะผะธ ะบะปััะฐะผะธ ะธ ะดะพะบัะผะตะฝัะฐะผะธ.
- ะผะตััะธัะตัะบะธะต ะฐะณัะตะณะฐัะธะธ - ัะฐะฑะพัะฐัั ั ะฟะพะปัะผะธ ัะธัะปะพะฒัั ัะธะฟะพะฒ. ะะฝะธ ะฒััะธัะปััั ัะตะฝะฝะพััั ัะธัะปะพะฒะพะณะพ ะฟะพะปั ะฒ ะบะพะฝะบัะตัะฝะพะผ ะบะพะฝัะตะบััะต.
- ะผะฐััะธัะฝัะต ะฐะณัะตะณะฐัะธะธ - ัะฐะฑะพัะฐัั ั ะฝะตัะบะพะปัะบะธะผะธ ะฟะพะปัะผะธ ะธ ะฒััะธัะปััั ะผะฐััะธัั ะฟะพ ะฒัะตะผ ะดะพะบัะผะตะฝัะฐะผ ะฒ ะฟัะตะดะตะปะฐั ะบะพะฝัะตะบััะฐ ะทะฐะฟัะพัะฐ.
- ะฐะณัะตะณะฐัะธะธ ะบะพะฝัะตะนะฝะตัะพะฒ - ัะฒะปััััั ะฐะณัะตะณะฐัะธัะผะธ ะฒัััะตะณะพ ะฟะพััะดะบะฐ ะธ ะผะพะณัั ะธัะฟะพะปัะทะพะฒะฐัั ะฒัะฒะพะด ะดััะณะธั ะฐะณัะตะณะฐัะธะน. ะญัะพ ะผะพะถะตั ะฑััั ะฟะพะปะตะทะฝัะผ ะดะปั ะฒััะธัะปะตะฝะธั ัะตะณะพ-ะปะธะฑะพ, ะฝะฐะฟัะธะผะตั ะฟัะพะธะทะฒะพะดะฝัั.

ะัะธะผะตั - ะฟัะพะฐะฝะฐะปะธะทะธััะตั ะดะฐะฝะฝัะต ะธ ะฒัะฒะตะดะตั ะดะฐะฝะฝัะต ะฟะพ `title` - ะธั ะฝะฐะทะฒะฐะฝะธะต ะธ ะบะพะป-ะฒะพ ะดะพะบัะผะตะฝัะพะฒ ั ัะฐะบะธะผ `title` , ัะธะฟ ะฟะพะปั ะดะพะปะถะตะฝ ะฑััั text(keyword ะธัะฟะพะปัะทัะตัััั ะดะปั ัะตะบััะพะฒัั ะฟะพะปะตะน)
```
GET /blog/post/_search
{
	"aggs": {
		"popular": { //ััะพ ะฟะพะปะต ะฑัะดะตั ัะพะทะดะฐะฝะพ ะฒ ัะตะบัะธะธ "aggregations"
			"terms":{"field": "title"}
		}
	}
}
```

#### ๐น ะัะธะผะตัั

==ะฒัะฒะตะดะตั ััะตะดะฝะต ัะตะฝั (ะฟะพะปะต ะดะพะปะถะฝะพ ะฑััั numeric) ะธะปะธ ะดััะณะธะต ะพะฟะตัะฐัะธะธ==
```
{
	"aggs": {
    "popular": {
      "terms" : {"field": "brand"},
       "aggs": {
          "avg_price": { 		// ัะพะทะดะฐัั ััะพ ะฟะพะปะต (ะผะพะถะฝะพ ัะบะฐะทัะฒะฐัั ะปัะฑะพะต)
            "avg": { 			// ะฒัััะธััะฒะฐะตั ััะตะดะฝัั ัะตะฝั
              "field": "price"
            }
          },
          "max_price": {
          	"max": {
          		"field": "price"
          	}
          },
          "stats_price": {
          	"stats": {			// ะฒัั ััะฐัะธััะธะบะฐ ะพ ัะตะฝะต
          		"field": "price"
          	}
          }
        }
      }
  }
}
```

==ัะฐะบะถะต ะฒ ะฐะณัะตะณะฐัะธะธ ะผะพะถะฝะพ ะธัะฟะพะปัะทะพะฒะฐัั range ะฟะพ ะดะฐัะต (ะธะปะธ ะดััะณะธะผ ะฟะฐัะฐะผะตััะฐะผ)==
```
{
	"aggs": {
		"popular": {
			"terms":{"field": "title"}
		},
		"aggs": {
			"range_data": {
				"range": {
					"field": "date",
					"ranges": [
						{"from": "2018-10-01","to": "2011-12-12"},		// ะฟะตัะฒัะน range
						{"from": "2011-10-01","to": "2015-12-12"},		// ะฒัะพัะพะน range
					]					
				},
				"aggs": { // ะฒ range ะผะพะถะฝะพ ะดะพะฑะฐะฒะปััั ัะฒะพั ะฐะณัะตะณะฐัะธั}
			}
		}
	}
}
```

==ะฐะณัะตะณะฐัะธั ะผะพะถะฝะพ ัะพะฒะผะตัะฐัั ั ะทะฐะฟัะพัะฐะผะธ==
```
{
	"query": {
		"match": {"color": "red"}
	},
	"aggs": {
		"popular": {
			"terms":{"field": "title"}
		}
	}
}
```

==ะตัะปะธ ะฝัะถะฝะพ ะฟะพะปััะธัั ะฐะณัะตะณะฐัะธั ะดะฐะฝะฝัั ะฑะตะท ัะฐะผะธั ะดะฐะฝะฝัั ะฒ ะฝะฐัะฐะปะต ะฝัะถะฝะพ ัััะฐะฝะพะฒะธัั "size": 0==
```
{
	"size": 0,
	"query": {
		"match": {"color": "red"}
	},
	"aggs": {
		"popular": {
			"terms":{"field": "title"}
		}
	}
}
```

==ะฐะณัะตะณะฐัะธั ะผะพะถะฝะพ ะฒะบะปะฐะดัะฒะฐัั ะฒ ะดััะณัั ะฐะณัะตะณะฐัะธั==
```
{
	"aggs": {
		"car_condition": {
			"terms": {
				"field": "condition.keyword"
			},
			"aggs"; {
				"avg_price": {
					"avg": {
						"field": "price"
					}
				},
				"make": { 			// ะฒะปะพะถะตะฝะฐั ะฐะณัะตะณะฐัะธั
					"terms": {
						"field": "make.keyword"
					}
				}
			}
		}
	}
}
```

> ะฒะปะพะถะตะฝะฝะฐั ะฐะณัะตะณะฐัะธั ะฑัะดะตั ะพะฑัะฐะฑะฐััะฒะฐัั ัะต ะดะฐะฝะฝัะต, ะบะพัะพััะต ะฟะพะฟะฐะปะธ ะฒ ะฟะตัะฒัั ะฐะณัะตะณะฐัะธั

#### ๐น stats

==ะพะฑะธัะฐะตั ะฒัั ััะฐัะธััะธะบั ะฟะพ ะดะพะบัะผะตะฝัะฐะผ==
```
GET bigginsight/_search
{
ยย"aggregations": {
ยยยย"download_stats": {
ยยยยยย"stats": {
ยยยยยยยย"field": "downloadTotal"
ยยยยยย}
ยยยย}
ยย},
ยย"size": 0
}
```

==ะฒ ะพัะฒะตัะต ะฒ ะฟะพะปะต  ะฟะพะปะต download_stats ,ะฑัะดะตั ัะฐะบะพะณะพ ะฒะธะดะฐ==
```
"download_stats": {
ยยยย"count": 242835,			// ะพะฑัะตะต ะบะพะป-ะฒะพ
ยยยย"min": 0,					// ะผะธะฝะธะผะฐะปัะฝะพะต ะทะฝะฐัะตะฝะธะต
ยยยยย"max": 241213,			// ะผะฐะบัะธะผะฐะปัะฝะพะต ะทะฝะฐัะตะฝะธะต
ยยยยย"avg": 9049.102065188297,	// ััะตะดะฝะตะต ะทะฝะฐัะตะฝะธะต
ยยยยย"sum": 2197438700			// ััะผะผะฐ
}
```

 
 ==ัะฐััะธัะตะฝัะน ัะฑะพั ััะฐัะธััะธะบะธ==
 ```
 GET bigginsight/_search
{
ยย"aggregations": {
ยยยย"download_estats": {
ยยยยยย"extended_stats": {			// ัะฐััะธัะตะฝะฐั ััะฐัะธััะธะบะฐ
ยยยยยยยย"field": "downloadTotal"
ยยยยยย}
ยยยย}
ยย},
ยย"size": 0
}
 ```

==ะพัะฒะตั ะฒ ะฟะพะปะต "download_estats", ะฑัะดะตั ัะฐะบะพะณะพ ะฒะธะดะฐ==
```
"download_estats": {
	"count": 242835,
ยยยย"min": 0,
ยยยย"max": 241213,
ยยยย"avg": 9049.102065188297,
ยยยย"sum": 2197438700,
ยยยย"sum_of_squares": 133545882701698,		// ััะผะผะฐ ะบะฒะฐะดัะฐัะพะฒ
ยยยย"variance": 468058704.9782911,			// ัะฐััะพะถะดะตะฝะธะต
ยยยย"std_deviation": 21634.664429528162,		// ะพัะบะปะพะฝะตะฝะธะต ะธ ะตะณะพ ะณัะฐะฝะธัั
ยยยย"std_deviation_bounds": {
ยยยย"upper": 52318.43092424462,
ยยยย"lower": -34220.22679386803
}
```

==ะฐะณัะตะณะฐัะธะธ ะผะพัะฝะพััะธ(ะบะพะป-ะฒะพ ัะฝะธะบะฐะปัะฝัั ะทะฝะฐัะตะฝะธ ะดะปั ะบะพะฝะบัะตัะฝะพะณะพ ะฟะพะปั)==
```
GET bigginsight/_search
{
ยย"aggregations": {
ยยยย"unique_visitors": {
ยยยยยย"cardinality": {
ยยยยยยยย"field": "username"
ยยยยยย}
ยยยย}
ยย},
ยย"size": 0
}

# ะพัะฒะตั
"unique_visitors": {
ยยยยยย"value": 79
}
```
---