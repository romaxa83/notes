
#### üîπ –ü–û–õ–£–ß–ò–¢–¨ –ó–ù–ê–ß–ï–ù–ò–ï

–ü—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Å –ø–æ–º–æ—â—å—é `Query DSL` (Domain Specific Language - —è–∑—ã–∫ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ elastic)

–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è HTTP-–∑–∞–ø—Ä–æ—Å –∫ `_search Api`

–ò–Ω–¥–µ–∫—Å –∏ —Ç–∏–ø —è–≤–ª—è—é—Ç—Å—è –Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã –∑–∞–ø—Ä–æ—Å –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –ø–æ –≤—Å–µ–º –∏–Ω–¥–µ–∫—Å–∞–º –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ.

–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –¥–≤—É–º—è —Å–ø–æ—Å–æ–±–∞–º–∏:
-  –ø–µ—Ä–µ–¥–∞–≤–∞—è –∑–∞–ø—Ä–æ—Å –ø–æ–∏—Å–∫–∞ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∑–∞–ø—Ä–æ—Å–∞
-  –ø–µ—Ä–µ–¥–∞–≤–∞—è –∑–∞–ø—Ä–æ—Å –≤ —Ç–µ–ª–µ –∑–∞–ø—Ä–æ—Å–∞

–í –∫–æ—Ç–æ—Ä–æ–º –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –¥–≤–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –≤—ã–±–æ—Ä–∫–∏ - `query` –∏ `filter`:
- `query` - –ø—Ä–∏ –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –∏–º `_score`(–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
- `filter` - –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç `_score` (—Ç–æ—á–Ω–µ–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –µ–≥–æ –≤ –Ω–æ–ª—å)

–û–±–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ

–í –∑–∞–ø—Ä–æ—Å–µ –º–æ–∂–Ω–æ —É–∫–∞–∑—ã–≤–∞—Ç—å `term` –∏–ª–∏ `match`
 - `term` - –∏—â–µ—Ç —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
 - `match` - –∏—â–µ—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 
–∫ –ø—Ä–∏–º–µ—Ä—É –µ—Å—Ç—å —Ç–æ–≤–∞—Ä —Å –∏–º–µ–Ω–µ–º - "packard bell" ,–µ—Å–ª–∏ –º—ã –≤ –ø–æ–∏—Å–∫–µ —É–∫–∞–∂–µ–º "packard" —á–µ—Ä–µ–∑ `term` , –æ–Ω –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ—Ç(—Ç.–∫. –Ω–µ—Ç —Ç–æ—á–Ω–æ–≥–æ —Å–æ–≤–ø–∞–¥–µ–Ω–∏—è), –∞ —á–µ—Ä–µ–∑ `match` –Ω–∞–π–¥–µ—Ç —Ç.–∫. –≤ –Ω–∞–∑–≤–∞–Ω–∏ –µ—Å—Ç—å "packard" 

–î–ª—è –æ–±—ä–µ–¥–µ–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `bool`, —ç—Ç–æ –º–æ—â–Ω—ã–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤–∫–ª—é—á–∞—Ç—å –≤ —Å–µ–±—è –∏ –¥—Ä—É–≥–∏–µ `bool`.

–ó–∞–ø—Ä–æ—Å –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏–º –∏–Ω–¥–µ–∫—Å–∞–º/—Ç–∏–ø–∞–º –ø–µ—Ä–µ–¥–∞–≤–∞—è –∏—Ö —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
```
POST blog,product/post,computer/_search
.... —Ç–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞
```

##### üî∏ –¢–ï–õ–û –ó–ê–ü–†–û–°–ê
```json
{
  "size": .....,      // –∫–æ–ª-–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –æ—Ç–≤–µ—Ç–µ(–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
  "from": .....,      // —Å–º–µ—â–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (offset)
  "timeout": ....,    // —Ç–∞–π–º-–∞—É—Ç –∑–∞–ø—Ä–æ—Å–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ–≥–æ –Ω–µ—Ç)
  "_source": ....,    // –ø–æ–ª—è –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ø–∞–¥—É—Ç –≤ –æ—Ç–≤–µ—Ç
  "query": {....},    // –∫–æ–Ω—Ç–µ–∫—Å—Ç –∑–∞–ø—Ä–æ—Å–∞
  "aggs": {....},     // –∞–≥—Ä–µ–≥–∞—Ü–∏—è
  "sort": {....}     // —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞
}
```


##### üî∏ –¢–ï–õ–û –û–¢–í–ï–¢–ê
```json
{
  "took":             // –≤—Ä–µ–º—è –ø–æ—Ç—Ä–∞—á–µ–Ω–æ–µ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö 
  "time_out":         // –±—ã–ª –ª–∏ –ø—Ä–µ–≤—ã—à–µ–Ω —Ç–∞–π–º-–∞—É—Ç,–µ—Å–ª–∏ –æ–Ω –±—ã–ª –∑–∞–¥–∞–Ω –¥–ª—è –∑–∞–ø—Ä–æ—Å–∞
  "_shards": {
    "total":          // –∫–æ–ª-–≤–æ —à–∞—Ä–¥–æ–≤ –∑–∞–¥–µ–π—Å—Ç–≤–æ–≤–∞–Ω—ã—Ö –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ
    "successful":     // –∫–æ–ª-–≤–æ —à–∞—Ä–¥–æ–≤ –≤–µ—Ä–Ω—É–≤—à–∏—Ö —É—Å–ø–µ—à–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    "failed":         // –∫–æ–ª-–≤–æ —à–∞—Ä–¥–æ–≤ —Å –æ—à–∏–±–∫–æ–π
  },
  "hits": {
    "total":          // –æ–±—â–µ–µ –∫–æ–ª-–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    "max_score":      // –º–∞–∫—Å. –∏–∑ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    "hits": [
                      // —Å–ø–∏—Å–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
    ]
  }
}
```
---
#### üîπ QUERY CONTEXT

##### üî∏ –≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
```
GET /product/_search
{
  "query": {
    "match_all": {}
  }
}
```

##### üî∏ –≤—ã—Ç—è–Ω–µ—Ç –¥–∞–Ω–Ω—ã–µ –≥–¥–µ –≤ –ø–æ–ª–µ name –±—É–¥–µ—Ç –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å computer
```
"query": {
    "match": {"name": "computer"} 
}
```

##### üî∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —Ü–µ–Ω–µ –∏ –∫–æ–ª-–≤—É
  > —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–æ –ø–µ—Ä–≤–æ–º—É –ø–æ–ª—é, –∑–∞—Ç–µ–º –ø–æ –≤—Ç–æ—Ä–æ–º—É –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ

```
"query": {
  "sort": [
    {"price": {"order": "desc"}},
    {"amount": {"order": "desc"}},
  ]
}
```

##### üî∏ –≤–∫–ª—é—á–µ–Ω–∏–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –¥–∞–Ω–Ω—ã–µ c –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –ø–æ–ª–µ
(–≤ –ø—Ä–∏–º–µ—Ä–µ "name")

```
"_source": ["name"],
"query": {
  "match": {"name": "computer"}
}
```

–º–æ–∂–Ω–æ —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–π –∑–Ω–∞–∫–∏  –≤–∫–ª—é—á–µ–Ω–∏–µ –≤ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π –¥–æ–∫—É–º–µ–Ω—Ç –≤—Å–µ—Ö –ø–æ–ª–µ–π –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—á–∏–Ω–∞—é—Ç—å—Å—è –Ω–∞ "pr" 

```
"_source": ["pr*"],
"query": {
  "match": {"name": "computer"}
}
```

##### üî∏ exists
–≤—ã—Ç—è–≥–∏–≤–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —É –∫–æ—Ç–æ—Ä—ã—Ö –±—É–¥–µ—Ç –ø–æ–ª–µ "price" –Ω–µ–≤–∞–∂–Ω–æ –ø—É—Å—Ç–æ–µ –∏–ª–∏ —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º 
```
"query": {
    "exists": {"field": "price"}
  }
```

##### üî∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø–æ–ª–µ–π –¥–ª—è –ø–æ–∏—Å–∫–∞

- `must` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –Ω–∞–ª–∏—á–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
- `must_not` - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ –Ω–µ –Ω–∞–ª–∏—á–∏–µ –∑–Ω–∞—á–µ–Ω–∏–π –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ

```
"query":{
  "bool": {
    "must": [
      {"match": {"category": "computer"}},
      {"match": {"brand": "hp"}},
    ],
    "must_not": [
      {"match": {"name": "pavilion"}}
    ]
  }
}
```

##### üî∏ should
–∞–Ω–∞–ª–æ–≥ `OR` –≤—ã—Ç—è–Ω–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ, –Ω–æ –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –≤ –ø–æ–ª—è—Ö —É–≤–µ–ª–∏—á–∏—Ç –∏—Ö `_score`.
–ù–∞—Å—Ç—Ä–æ–π–∫–∞ - `minimal_should_match` - —É–∫–∞–∑—ã–≤–∞–µ—Ç –∫ —Å–∫–æ–ª—å–∫–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º –ø—Ä–∏–º–µ–Ω—è—Ç—å `should`.

```
"query":{
  "bool": {
    "should": [
      {"match": {"name": "computer"}},
      {"match": {"room": "c12"}},
    ],
    "minimal_should_match":1 
  }
}
```

##### üî∏ multi_match

–≤—ã–≤–µ–¥–µ—Ç –¥–∞–Ω–Ω—ã–µ, –≥–¥–µ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ–ª—è "name" –∏ "room" –∏ –≤ –∫–∞–∂–¥–æ–º –∏–∑ –ø–æ–ª–µ–π (–∏–ª–∏ —É –æ–±–æ–∏—Ö) –±—É–¥–µ—Ç "computer", —á—Ç–æ–±—ã —É–≤–µ–ª–∏—á–∏—Ç—å _score –≤ –∫–æ–Ω–µ—Ü –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —Å–∏–º–≤–æ–ª - `^n` (`room^2`)

```
"query": {
  "multi_match": {
    "fields": ["name","room"], 
    "query": "computer"
  }
}
```

##### üî∏ match_phrase

–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `match_phrase`, –Ω–æ –µ—Å–ª–∏ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –æ–±—Ä–µ–∑–∞–Ω–Ω–æ–µ —Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑–∞ (–∏–ª–∏ –Ω–µ —Ç–æ—á–Ω–æ–µ —Å–ª–æ–≤–æ –∏–ª–∏ —Ñ—Ä–∞–∑–∞) –∑–∞–ø—Ä–æ—Å –Ω–µ –≤–µ—Ä–Ω–µ—Ç –æ—Ç–≤–µ—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
  - `slop` - –∫–æ—Ç–æ—Ä—ã–π –∑–∞–¥–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ —Å–ª–æ–≤ –º–æ–∂–µ—Ç –≤–∫–ª–∏–Ω–∏–≤–∞—Ç—å—Å—è –º–µ–∂–¥—É —Å–ª–æ–≤–∞–º–∏

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `match_phrase_prefix` - —Ç–æ–≥–¥–∞ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –æ–±—Ä–µ–∑–∞–Ω—ã–µ —Å–ª–æ–≤–∞ –∏ –¥–∞—Ç—ã.

```
"query": {
  "match_phrase": {
    "description": "bla-bla-bla"
  }
}

####

"query": {
  "match_phrase": {
    "description": {
      "query": "all jacket",
      "slop": 1
    }
  }
}
```

##### üî∏ –ü–æ–∏—Å–∫ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É

–ø–æ–∏—Å–∫ –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `range` (–¥–ª—è —á–∏—Å–µ–ª –∏ –¥–∞—Ç), –≥–¥–µ: 
  - `gte` - –±–æ–ª—å—à–µ –∏ —Ä–∞–≤–Ω–æ
  - `gt` - –±–æ–ª—å—à–µ
  - `lte` - –º–µ–Ω—å—à–µ –∏ —Ä–∞–≤–Ω–æ
  - `lt` - –º–µ–Ω—å—à–µ

```
"query": {
  "range": {
    "price": {
      "gte": 10,
      "lte": 20
    }
  }
}
```

##### üî∏ –ø–æ–∏—Å–∫ –ø–æ –¥–∞—Ç–∞–º

- `now` - –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –≤—Ä–µ–º–µ–Ω–∏
- `now/y` - —Ç–µ–∫—É—â–∏–π –≥–æ–¥
- `now-1h` - –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å (–º–∏–Ω—É—Å—É–µ—Ç –æ–¥–∏–Ω —á–∞—Å)
- `now+1M` - –¥–æ–±–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω –º–µ—Å—è—Ü
- `2017-02-01||-1M` - –≤—ã—á–∏—Ç–∞–µ—Ç –æ—Ç –¥–∞—Ç–∞ –æ–¥–∏–Ω –º–µ—Å—è—Ü (—Å–∏–º–≤–æ–ª `||` - —Ä–∞–∑–¥–µ–ª—è–µ—Ç –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏)
- `now/d` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –¥–Ω—è
- `now+1M-1d/d` - –¥–æ–±–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω –º–µ—Å—è—Ü, –≤—ã—á–∏—Ç–∞–µ—Ç –æ–¥–∏–Ω –¥–µ–Ω—å –∏ –æ–∫—Ä—É–≥–ª—è–µ—Ç –¥–æ –±–ª–∏–∂–∞–π—à–µ–≥–æ –¥–Ω—è

—Å–∏–º–≤–æ–ª—ã:
- `y` - –≥–æ–¥
- `M` - –º–µ—Å—è—Ü
- `d` - –¥–µ–Ω—å
- `H` - —á–∞—Å
- `m` - –º–∏–Ω—É—Ç–∞
- `s` - —Å–µ–∫—É–Ω–¥–∞

```
"query": {
  "range": {
    "release_date": {
      "gt": "now-1h"
    }
  }
}
```

##### üî∏ scripts

 –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤ –∑–∞–ø—Ä–æ—Å, —è–∑—ã–∫ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤ elastic –Ω–∞–∑—ã–≤–∞–µ—Ç—Å—è `Painless` —Å—Ü–µ–Ω–∞—Ä–∏–π —Ä–∞—Å—á–∏—Ç—ã–≤–µ—Ç —Ü–µ–Ω—É —Å –Ω–∞–ª–æ–≥–æ–º (10%) –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–æ–≤–æ–µ –ø–æ–ª–µ ("price_tax") —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º

```
"query": {
  "match_all":{}
},
"script_fields": {
  "price_tax": {
    "script": {
      "source": "params['_source']['price'] * 1.1"
    }
  }
}
```

##### üî∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø—Ä–µ—Ñ–∏–∫—Å–∞

–Ω–∞–π–¥–µ—Ç –≤—Å–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –≥–¥–µ –∫–æ—Ç–æ—Ä—ã–µ –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è —Å –ø—Ä–µ—Ñ–∏–∫—Å–∞ "–∫—É"

```
"query": {
  "prefix": {
    "name": "–∫—É"
  }
}
```

##### üî∏ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã–µ –∑–Ω–∞–∫–∏

–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–æ—á–Ω—ã—Ö –∑–Ω–∞–∫–æ–≤:
-  `*` - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª—é–±–æ–º—É –∫–æ–ª-–≤—É —Å–∏–º–≤–æ–ª–æ–≤
- `?` - —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–¥–Ω–æ–º—É —Å–∏–º–≤–æ–ª—É 

```
"query": {
  "wildcard" : {
    "name" : "–∫*—Ç?"
  }
}
```

##### üî∏ regexp
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–≥—É–ª—è—Ä–Ω–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è (–æ—á–µ–Ω—å –¥–æ—Ä–æ–≥–∏–µ)

```
"query": {
  "regexp" : {
    "product_name" : "–∫—É—Ä—Ç."
  }
}
```
---
#### üîπ FILTER CONTEXT

–æ—Ç–ª–∏—á–∏–µ –æ—Ç –ø–æ–∏—Å–∫–∞(`query`) —É —Ñ–∏–ª—å—Ç—Ä–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä `_score`(–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç) –≤—Å–µ–≥–¥–∞ —Ä–∞–≤–µ–Ω 0, –æ–Ω –ø—Ä–æ—Å—Ç–æ —Ñ–∏–ª—å—Ç—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ, –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –±—ã—Å—Ç—Ä–µ–µ —á–µ–º query


==–±–∞–∑–æ–≤–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è (–≤–µ—Ä–Ω–µ—Ç –¥–∞–Ω–Ω—ã–µ ,–≥–¥–µ –≤ –ø–æ–ª–µ "name" –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Å–ª–æ–≤–æ "book")==
```
GET /blog/_search
{
  "query": {
    "bool": {
      "filter": {
        "match": {
          "name": "book"
        }
      }
    }
  }
}
```

##### üî∏ bool
—Ñ–∏–ª—å—Ç—Ä —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å (–∫–∞–∫ –∏ `query`) `must`, `must_not`, `should`

```
"query": {
  "bool": {
    "filter": {
      "bool": {
        "must": [
          {"match": {"name": "book"}},
          {"match": {"author": "bill"}}
        ],
        "must_not": [
          {"match": {"category": "travel"}}
        ]
      }
    }
  }
}
```

–∏–º–µ–µ—Ç –º–µ—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `must` –∏–ª–∏ `must_not`, –Ω–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ñ–∏–ª—å—Ç—Ä–∞  –∏ —Ç–æ–≥–¥–∞ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —Å–æ `_score`

```
"query": {
  "bool": {
    "filter": {
      "bool": {
        "must": [
          {"match": {"name": "book"}},
          {"match": {"author": "bill"}}
        ]
      }
    },
    "must": [
      {"match": {"category": "action"}}
    ]
  }
}
```
---
#### üîπ –£–í–ï–õ–ï–ß–ï–ù–ò–ï `_SCORE` (–ü–æ–ø—É–ª—è—Ä–Ω–æ—Å—Ç—å –æ—Ç–≤–µ—Ç–∞)

—É–≤–µ–ª–µ—á–µ–Ω–∏—è `_score` –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞–∫–∏—Ö-—Ç–æ –ø–æ–ª–µ–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `function_score`
  
```
"query": {
  "function_score": {
    "query": {}
    "function": [],
    "filter": {},
    "filter_value_factor": {}   // —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç —Å—á–µ—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–µ
  }
}
```

==—É–≤–µ–ª–∏—á–∏–≤–∞–µ–º _score –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø–æ–ª—è "review"==

```
"query": {
  "function_score": {
    "query": {
      "match": {"name": "computer"}
    },
    "field_value_factor": {
      "field": "review"
    }
  }
}
```


 `_score` –º–æ–∂–Ω–æ –∑–∞–¥–∞–≤–∞—Ç—å –∫–æ—ç—Ñ–∏—Ü–∏–µ—Ç —É–≤–µ–ª–µ—á–µ–Ω–∏, —Ñ–æ—Ä–º—É–ª —É–≤–µ–ª–µ—á–µ–Ω–∏—è - `_score + (factor * reviews)`

```
"query": {
  "function_score": {
    "query": {
      "match": {"name": "computer"}
    },
    "field_value_factor": {
      "field": "review",
      "factor": "0.25"
    }
  }
}
```

##### üî∏ `boost`
–ø—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö , –æ–±—å–µ–¥–∏–Ω–µ–Ω—ã—Ö –≤ `bool`, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å –≤–µ—Å —ç—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –∫–æ–Ω–µ—á–Ω–æ–≥–æ `_score` , —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ `boost`

```
"query": {
  "bool": {
    "must": [
      {
        "match": {"name": "computer"}
      }
    ],
    "should": [
      {
        "range": {
          "price": {
            "lt": 100,
            "boost": 0.5
          }
        }
      },
      {
        "range": {
          "reviews": {
            "gte": 25,
            "boost": 2
          }
        }
      }
    ]
  }
}
```

##### üî∏ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å–ø–∞–¥–∞

–¢–∞–∫–∂–µ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `_score` –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Å –ø–æ–º–æ—â—å—é —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞—Å–ø–∞–¥–∞ - –æ–Ω–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–∞–∫, –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∏ –¥–∞–ª–µ–µ –æ—Ü–µ–Ω–∫–∞ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è, –ø–æ—Å–∫–æ–ª—å–∫—É –∑–Ω–∞—á–µ–Ω–∏–µ —É–¥–∞–ª—è–µ—Ç—Å—è –æ—Ç –Ω–∞—á–∞–ª–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç. –ù–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏—â–µ—Ç —Ä–µ—Å—Ç–æ—Ä–∞–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—É–Ω–∫—Ü–∏—é —Ä–∞—Å–ø–∞–¥–∞ –æ—Ü–µ–Ω–∫–∞ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è, –∞ –Ω–µ –≤–Ω–µ–∑–∞–ø–Ω–æ –ø–∞–¥–∞–µ—Ç. –ß—Ç–æ–± –µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –Ω–∞—á–∞–ª–æ –∏ –º–∞—Å—à—Ç–∞–±, –ø–∞—Ä–∞–º–µ—Ç—Ä `scale` –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç —Å–∫–æ—Ä–æ—Å—Ç—å, —Å –∫–æ—Ç–æ—Ä–æ–π –æ—Ü–µ–Ω–∫–∞ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –æ—Ç –Ω–∞—á–∞–ª–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç.

==–ü—Ä–∏–º–µ—Ä: "now" - –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ,"180d" - –º–∞—Å—à—Ç–∞–± (180 –¥–Ω–µ–π)==
```
"query": {
  "function_score": {
    "functions": [
      {
        "gauss": {
          "release_date": {
            "origin": "now",
            "scale": "180d"
          }
        }
      }
    ]
  }
}
```

==—Ç–∞–∫–∂–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ—É–Ω–∫—Ü–∏ —Ä–∞—Å–ø–∞–¥–∞ –∏ –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –≤–µ—Å –∫–∞–∂–¥–æ–π –∏–∑ –Ω–∏—Ö==
```
"query": {
  "function_score": {
    "query": {
      "match": {
        "product_name": {
          "query": "–∫—É—Ä—Ç–∫–∞"
        }
      }
    },
    "functions": [
      {
        "gauss": {
          "unit_price": {
            "origin": "50",
            "scale": "15"
          }
        },
        "weight": 1
      },
      {
        "gauss": {
          "release_date": {
            "origin": "now",
            "scale": "180d"
          }
        },
        "weight": 2
      }
    ]
  }
}
```
---
##### üî∏ rescore

–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –º–Ω–æ–≥–æ, —Ç–æ —Ä–∞—Å—á–µ—Ç `_score` –¥–ª—è –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –±—É–¥–µ—Ç –¥–æ–≤–æ–ª—å–Ω–æ –¥–æ—Ä–æ–≥–æ—Å—Ç–æ—è—â–µ–π –æ–ø–µ—Ä–∞—Ü–∏–µ–π, –ø–æ—ç—Ç–æ–º—É elastic –ø–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞—Å—á–∏—Ç–∞–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–µ—Ä—Ö–Ω–µ–µ n-–æ–µ –∫–æ–ª-–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `rescore`

==–¥–ª—è 10 –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –ª–æ–≥–∞—Ä–∏—Ñ–º–∏—á–µ—Å–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è==
```
"query": {
  "match": {
    "product_name": {
      "query": "–∫—É—Ä—Ç–∫–∞"
    }
  }
},
"rescore": {
  "window_size": 10,
  "query": {
    "rescore_query": {
      "function_score": {
        "script_score": {
          "script": {
            "inline": "Math.log(params['_source']['reviews'])"
          }
        }
      }
    },
   "query_weight": 0.5,
    "rescore_query_weight": 1.0
  }
} 
```

##### üî∏ `explain`

–¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ `_score` (—Å–∫–æ–ª—å–∫–æ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–æ–±–∞–≤–ª—è—é—Ç –∫ `_score` –±–∞–ª–ª–æ–≤)

```
POST product/_search?explain=true
 {
   "query": {
     "match": {
       "description" : "–∫—É—Ä—Ç–∫–∞"
     }
   }
 }
```
---
#### üîπ –ü–û–ò–°–ö –ß–ï–†–ï–ó –ê–î–†–ï–°–ù–£–Æ –°–¢–†–û–ö–£

```
GET /product/computer/_search?q=brand:apple
GET example3/history/_search?q=UNKNOWN
```

#### üîπ `routing`

–ü—Ä–∏ –ø–æ–∏—Å–∫–µ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é –¥–ª—è —à–∞—Ä–¥–æ–≤ –µ—Å–ª–∏ –º—ã –∑–Ω–∞–µ–º —á—Ç–æ –≤—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ–º —à–∞—Ä–¥–µ, —Å –ø–æ–º–æ—â—å—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞—â–∞–µ–º—Å—è –∫ –Ω—É–∂–Ω–æ–º—É —à–∞—Ä–¥—É, –Ω–µ –±–µ—Å–ø–æ–∫–æ—è –¥—Ä—É–≥–∏–µ (–∫ –ø—Ä–∏–º–µ—Ä—É –Ω–∞ –æ–¥–Ω–æ —à–∞—Ä–¥–µ –º–æ–∂–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö –∑–∞–∫–∞–∑–∞—Ö –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è)

==–ó–∞–¥–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—É—é –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—é==
```
PUT user/_mapping/order
 {
  "_routing": {
     "required": true
   },
   "properties": {
    	"order_id": {
       		"type": "text"
     	},
     	"user_id": {
       		"type": "keyword"
     	},
   	}
 }
```

==–¥–æ–±–∞–≤–ª–µ–Ω–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö( –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ,–ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç –æ—à–∏–±–∫–∞)==
```
PUT example3/order/1?routing=user1
{
   "order_id": "23y86",
   "user_id": "user1"
}
```

==–ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö==
```
GET example3/order/1?routing=user1
```

–î–∞–Ω–Ω–∞—è —Ç–µ—Ö–Ω–∏–∫–∞ (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è) –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–±—Ä–∞—Ç—å –∏–∑–ª–∏—à–Ω—é—é –Ω–∞–≥—Ä—É–∑–∫—É –Ω–∞ –∫–ª–∞—Å—Ç–µ—Ä, –Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–µ —Å—Ç–æ–∏—Ç –æ—á–µ–Ω—å –∞–∫–∫—É—Ä–∞—Ç–Ω–æ(–∫ –ø—Ä–∏–º–µ—Ä—É —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∞–∑–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –∑–∞–∫–∞–∑–æ–≤ –∏ –≤–æ–∑–º–æ–∂–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è –∫–æ–≥–¥–∞ —É –∫—Ä—É–ø–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –º–æ–≥—É—Ç –æ–∫–∞–∑–∞—Ç—å—Å—è –Ω–∞ –æ–¥–Ω–æ–º —à–∞—Ä–¥–µ, —á—Ç–æ –≤ —Å–≤–æ—é –æ—á–µ—Ä–µ–¥—å –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –Ω–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ–º—É —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—é –¥–∞–Ω–Ω—ã—Ö –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—é –≤—Å–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞)

---
#### üîπ –ü–æ–ª–Ω–æ—Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

elastic –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç API –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä, —á—Ç–æ–±—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫ –æ–Ω –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç —Ç–µ–∫—Å—Ç –≤–Ω—É—Ç—Ä–∏

```
GET _analyze?analyzer=russian&text=%D0%92%2B%D0%9C%D0%BE%D1%81%D0%BA%D0%B2%D0%B5%2B%D0%B2%D1%81%D0%B5%2B%D0%B2%D1%8B%D1%85%D0%BE%D0%B4%D0%BD%D1%8B%D0%B5%2B%D0%B1%D1%83%D0%B4%D1%83%D1%82%2B%D0%B4%D0%BE%D0%B6%D0%B4%D0%B8
```


–¢–µ–∫—Å—Ç –±—É–¥–µ—Ç —Ä–∞–∑–±–∏—Ç –Ω–∞ –ª–µ–∫—Å–µ–º (–∫–æ—Ä–Ω–∏ —Å–ª–æ–≤) –≤ –≤–∏–¥–µ —Ç–æ–∫–µ–Ω–æ–≤ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Å–ª–æ–≤–µ –≤ —Ç–µ–∫—Å—Ç–µ.
–ï—Å–ª–∏ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä –Ω–µ –∑–∞–¥–∞–Ω –ø—Ä–∏ –º–∞–ø–ø–∏–Ω–≥–µ, –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –ø–æ–ª—è –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è —Å –ø–æ–º–æ—â—å—é
—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞, –∫ —Ä–∞–∑–Ω—ã–º –ø–æ–ª—è–º –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å—Ö–µ–º—ã –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–π –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä.

```
PUT blog/_mapping/weather
 {
   "properties": {
     "desc": {
       "type": "text",
       "analyzer": "russian"
     }
   }
 }
```
---