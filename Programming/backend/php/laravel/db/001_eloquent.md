#php #laravel #database 

#### ğŸ”¹ SELECT

```php
// Ğ²ĞµÑ€Ğ½ĞµÑ‚ Ğ¾Ğ±ÑŒĞµĞºÑ‚ Ñ id=1
Post::find(1);

// Ğ²ĞµÑ€Ğ½ĞµÑ‚ ĞºĞ¾Ğ»ĞµĞºÑ†Ğ¸Ñ
Post::find([1,2,3]);

// Ğ²ĞµÑ€Ğ½ĞµÑ‚ Ñ Ğ¾Ğ¿Ñ€ĞµĞ´ĞµĞ»ĞµĞ½Ñ‹Ğ¼Ğ¸ Ğ¿Ğ¾Ğ»ÑĞ¼Ğ¸
Post::find(1, ['id', 'title']);

// Ğ²ĞµÑ€Ğ½ĞµÑ‚ Ğ²ÑĞµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ğµ
Post::all();

// ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ĞºĞ°ĞºĞ¸Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ
Post::all(['id', 'title']);

// Ğ¼ĞµÑ‚Ğ¾Ğ´ ĞºÑƒÑ€ÑĞ¾Ñ€ Ğ±ĞµÑ€ĞµÑ‚ Ğ¿Ğ¾ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹ Ğ·Ğ° Ñ€Ğ°Ğ·
Post::orderBy('views','desc')->cursor();
```
---
#### ğŸ”¹ UPDATE

```php
// Ğ² Ğ¼Ğ¾Ğ´ĞµĞ»Ğ¸ Ğ¿Ğ¸ÑˆĞµĞ¼ Ğ¼ĞµÑ‚Ğ¾Ğ´
// Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ·Ğ¾Ğ²Ğµ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ½Ğ° 1

public function changeStatus()
{
	$this->update([
		'status' => 1
	]);
}
```
---
#### ğŸ”¹ Ğ¢Ğ ĞĞĞ—ĞĞšĞ¦Ğ˜Ğ˜

```php
// callback, Ğ¿Ñ€Ğ¸Ğ½Ğ¸Ğ¼Ğ°ĞµÑ‚ Ğ²Ñ‚Ğ¾Ñ€Ğ¾Ğ¹ (Ğ½ĞµĞ¾Ğ±ÑĞ·Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹) Ğ¿Ğ°Ñ€Ğ°Ğ¼ĞµÑ‚Ñ€ - ÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ğ¾Ğ²Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ Ñ€Ğ°Ğ·, Ğ¿Ñ€ĞµĞ¶Ğ´Ğµ Ñ‡ĞµĞ¼ Ğ¿Ñ€Ğ¸Ğ·Ğ½Ğ°Ñ‚ÑŒ Ğ½ĞµÑƒĞ´Ğ°Ñ‡Ñƒ
DB::transaction(function(){
	User::create([]);
	Category::create([]);
}, 4);

// Ğ¸Ğ»Ğ¸ Ñ‚Ğ°Ğº
DB::beginTransaction();

try {
	$user = User::create([]);
	Category::create([]);
        $report->save();

    DB::commit();

    return $user;
} catch(\Exception $exception) {
    DB::rollBack();

    throw new \Exception($exception->getMessage());
}
```
---
#### ğŸ”¹ ĞŸĞĞ”Ğ—ĞĞŸĞ ĞĞ¡

```php
// Ğ¿Ğ¾Ğ´Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ´Ğ°Ñ‚Ñ‹ Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½ĞµĞ³Ğ¾ ĞºĞ¾Ğ¼Ğ¼ĞµĞ½Ñ‚Ğ°Ñ€Ğ¸Ñ
$lastComment = Comment::select('created_at')
    ->whereColumn('user_id', 'users.id')
    ->latest()
    ->limit(1)
    ->getQuery();

// Ğ²ÑÑ‚Ğ°Ğ²Ğ»ÑĞµĞ¼ Ğ¿Ğ¾Ğ´Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ² Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
$users = User::select('users.*')
    ->selectSub($lastComment, 'last_comment_at')
    ->get();
```
---
#### ğŸ”¹ INCREMENT

```php
// ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ 'read_count' Ğ½Ğ° 1
Post::find(1)->increment('read_count');

// ÑƒĞ²ĞµĞ»Ğ¸Ñ‡Ğ¸Ñ‚ 'read_count' Ğ½Ğ° 10
Post::find(1)->increment('read_count', 10);

// ÑƒĞ¼ĞµĞ½ÑŒÑˆĞ¸Ñ‚ 'read_count' Ğ½Ğ° 1
Post::find(1)->decrement('read_count');

```
---
#### ğŸ”¹ WITH (Ğ¶Ğ°Ğ´Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°)

> Ğ¶Ğ°Ğ´Ğ½Ğ°Ñ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° - ĞºĞ¾Ğ³Ğ´Ğ° Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶Ğ°ÑÑ‚ÑÑ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸Ñ Ñ Ğ¾ÑĞ½Ğ¾Ğ²Ğ½Ñ‹Ğ¼ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ¼ Eloquent

```php
// Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°Ñ‚ÑŒ ĞºĞ°ĞºĞ¸Ğµ Ğ¿Ğ¾Ğ»Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°Ñ‚ÑŒ Ñƒ ÑĞ²ÑĞ·Ğ¸
User::query()
	->with('profile:first_name,last_name')
    ->get();
```
---
#### ğŸ”¹ MAP

```php
// Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚ Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ¼Ğ¾Ñ‰Ğ¸ map()
$users = User::where('id', 1)
    ->get()
    ->map(function (User $user) {
        $user->some_column = some_function($user);
        return $user;
    });
```
---
#### ğŸ”¹ HASMANY

```php
// Ğ’ Ğ¾Ñ‚Ğ½Ğ¾ÑˆĞµĞ½Ğ¸ÑÑ… hasMany() Ğ²Ñ‹ Ğ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¾Ñ‚Ñ„Ğ¸Ğ»ÑŒÑ‚Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸, 
// Ğ¸Ğ¼ĞµÑÑ‰Ğ¸Ğµ n-Ğ¾Ğµ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ¾Ñ‡ĞµÑ€Ğ½Ğ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹.

// Author -> hasMany(Book::class)
$authors = Author::has('books', '>', 5)->get();

// Ğ¸Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞµÑĞ»Ğ¸ ĞµÑÑ‚ÑŒ ÑĞ²ÑĞ·Ğ¸
// Author -> hasMany(Book::class);
// Book -> hasMany(Rating::class);
$authors = Author::has('books.ratings')->get();
```
---
#### ğŸ”¹ WHERE DATE

```php
// Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸ Ğ´Ğ°Ñ‚Ñ‹
Product::whereDate('created_at', '2018-01-31')->get();
Product::whereMonth('created_at', '12')->get();
Product::whereDay('created_at', '31')->get();
Product::whereYear('created_at', date('Y'))->get();
Product::whereTime('created_at', '=', '14:13:58')->get();
```
---
#### ğŸ”¹ WHEN

> Ñ‡Ñ‚Ğ¾Ğ± Ğ¸Ğ·Ğ±ĞµĞ¶Ğ°Ñ‚ÑŒ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¹ Ğ² Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€ when

```php
// Ğ²Ğ¼ĞµÑÑ‚Ğ¾ Ñ‚Ğ°ĞºĞ¾Ğ¹ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸
if (request('filter_by') == 'likes') {
    $query->where('likes', '>', request('likes_amount', 0));
}

// Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ
$query->when(request('filter_by') == 'likes', function ($q) {
    return $q->where('likes', '>', request('likes_amount', 0));
});
```
---
#### ğŸ”¹ CHUNK

> Ğ¿Ñ€Ğ¸ Ğ¾Ğ±Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ¸ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ² Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ¸Ğ¼ĞµĞµÑ‚ ÑĞ¼Ñ‹ÑĞ» Ñ€Ğ°Ğ·Ğ±Ğ¸Ñ‚ÑŒ Ğ¸Ñ… Ğ½Ğ° Ñ‡Ğ°ÑÑ‚Ğ¸ Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞºĞ°Ğ·Ñ‹Ğ²Ğ°Ñ‚ÑŒ ÑÑ€Ğ°Ğ·Ñƒ Ğ¿Ñ€Ğ¸ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞµ Ğ¸Ğ»Ğ¸ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ğ°Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾Ğ»Ğ»ĞµĞºÑ†Ğ¸Ñ

```php
User::chunk(100, function ($users) {
    foreach ($users as $user) {
        // ...
    }
});
```
---
#### ğŸ”¹ PAGINATION

==Offset Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ offset)==
```php
$users = User::orderBy('id')->simplePaginate(10);

# Ğ±ÑƒĞ´ĞµÑ‚ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ¾ 10 ÑĞ»ĞµĞ¼ĞµĞ½Ñ‚Ğ¾Ğ² Ğ¿Ğ¾ ĞºĞ°Ğ¿Ğ¾Ñ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ñ‚Ğ°ĞºĞ¾Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ
# select * from users order by `id` asc limit 10 offset 10;
```

 ==Cursor Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ where)==
```php
$users = User::orderBy('id')->cursorPaginate(10);
```

Ğ­Ñ‚Ğ¾ Ğ²Ñ‹ÑĞ¾ĞºĞ¾Ğ¿Ñ€Ğ¾Ğ¸Ğ·Ğ²Ğ¾Ğ´Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ ÑĞ¿Ğ¾ÑĞ¾Ğ± Ñ€Ğ°Ğ·Ğ±Ğ¸ĞµĞ½Ğ¸Ñ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹, Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ğ´Ğ»Ñ Ğ±Ğ¾Ğ»ÑŒÑˆĞ¸Ñ… Ğ½Ğ°Ğ±Ğ¾Ñ€Ğ¾Ğ², Ğ±ĞµÑĞºĞ¾Ğ½ĞµÑ‡Ğ½Ñ‹Ñ… Ğ¿Ñ€Ğ¾ĞºÑ€ÑƒÑ‚Ğ¾Ğº Ğ¿Ğ¾ ĞºĞ°Ğ¿Ğ¾Ñ‚ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ñ‚Ğ°ĞºĞ¾Ğ¹ Ğ·Ğ°Ğ¿Ñ€Ğ¾Ñ `select * from users where `id` > 10 order by `id` asc limit 10;`
ĞšÑƒÑ€ÑĞ¾Ñ€Ğ½Ğ°Ñ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ ÑÑƒÑ‰ĞµÑÑ‚Ğ²ĞµĞ½Ğ½Ğ¾ Ğ±Ñ‹ÑÑ‚Ñ€ĞµĞµ, Ğ¿Ñ€Ğ¸ ÑƒÑĞ»Ğ¾Ğ²Ğ¸Ğ¸ Ñ‡Ñ‚Ğ¾ Ğ½Ğ° Ğ¿Ğ¾Ğ»Ğµ `orderBy` Ğ¿Ñ€Ğ¾ÑÑ‚Ğ°Ğ²Ğ»ĞµĞ½ Ğ¸Ğ½Ğ´ĞµĞºÑ Ğ¸ Ğ¾Ğ½Ğ¾ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ğ¾ Ğ¿Ğ»ÑÑ Ğ¾Ğ½Ğ° Ğ±Ğ¾Ğ»ÑŒÑˆĞµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚ Ğ´Ğ»Ñ Ğ±Ñ‹ÑÑ‚Ñ€Ğ¾ Ğ¼ĞµĞ½ÑÑÑ‰Ğ¸Ñ…ÑÑ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…, Ğ½Ğ¾ Ğ¿Ñ€Ğ¸ ÑÑ‚Ğ¾Ğ¼ Ñƒ Ğ½ĞµĞµ Ğ½ĞµÑ‚ ÑÑÑ‹Ğ»ĞºĞ¸ Ğ½Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹, ĞµÑÑ‚ÑŒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° Ğ¿Ñ€ĞµĞ´Ñ‹Ğ´ÑƒÑ‰ÑƒÑ Ğ¾ Ğ¿Ğ¾ÑĞ»ĞµĞ´ÑƒÑÑ‰ÑƒÑ, Ñ‚.Ğµ. ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾ Ğ½Ğ¾Ğ¼ĞµÑ€Ğ° ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹, Ñ‚Ğ¾ Ğ´Ğ°Ğ½Ğ½Ğ°Ñ Ğ¿Ğ°Ğ³Ğ¸Ğ½Ğ°Ñ†Ğ¸Ñ Ğ½Ğµ Ğ¿Ğ¾Ğ´Ñ…Ğ¾Ğ´Ğ¸Ñ‚.
Ğ¢Ğ°ĞºĞ¶Ğµ Ğ½ÑƒĞ¶Ğ½Ğ¾, Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ½Ğ°Ğ¿Ñ€Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ñ Ğ²ÑĞµÑ… Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ² `order by` Ğ±Ñ‹Ğ»Ğ¸ Ğ¾Ğ´Ğ¸Ğ½Ğ°ĞºĞ¾Ğ²Ñ‹Ğ¼Ğ¸, Ñ‚.Ğµ. Ğ²Ñ‹ Ğ½Ğµ ÑĞ¼Ğ¾Ğ¶ĞµÑ‚Ğµ Ğ¸Ğ¼ĞµÑ‚ÑŒ Ğ¾Ğ´Ğ¸Ğ½ `ASC` Ğ¸ Ğ¾Ğ´Ğ¸Ğ½ `DESĞ¡` Ğ² `order by`

---
#### ğŸ”¹ toQuery

> Ğ”Ğ»Ñ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ€Ğ°Ğ·Ñƒ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¸Ñ… Ğ·Ğ°Ğ¿Ğ¸ÑĞµĞ¹, Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ `toQuery`, Ğ° Ğ½Ğµ Ğ¿ĞµÑ€ĞµĞ±Ğ¸Ñ€Ğ°Ñ‚ÑŒ Ğ² Ñ†Ğ¸ĞºĞ»Ğµ

```php
$users->toQuery()->update(['status' = 'active']);
```
---