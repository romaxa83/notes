#php #laravel #websocket

#### üîπ Laravel Echo

- —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º `redis` –∏ –±–∏–±–ª–∏–æ—Ç–µ–∫—É (–∏–ª–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ) –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–µ–π
-  –≤ .env –ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ `redis` ,–∞ —Ç–∞–∫–∂–µ
```ini
BROADCAST_DRIVER=redis 
QUEUE_DRIVER=redis
```

- –ø–æ—Å–ª–µ —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –∫–µ—à –Ω–∞—Å—Ç—Ä–æ–µ–∫ 
```bash
php artisan config:cache
```

- –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º 
```bash
sudo npm install -g larave-echo-server
```
- –∞ —Ç–∞–∫–∂–µ `js`-–±–∏–±–ª–∏–æ—Ç–µ–∫–∏
```bash
npm install --save laravel-echo socket.io-client
```

- –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–µ—Ä–≤–µ—Ä
```bash
laravel-echo-server init
```

-  —Ä–∞—Å–∫–æ–º–µ–Ω—Ç–∏—Ä—É–µ–º —Å—Ç—Ä–æ—á–∫—É –≤ –∫–æ–Ω—Ñ–∏–≥–µ `config/app.php` `App\Providers\BroadcastServiceProvider::class` –æ–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –∏–∑ —Ñ–∞–π–ª–∞ `route/channels.php` –≤ `route/channels.php` –º—ã –º–æ–∂–µ–º –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ –∫–∞–Ω–∞–ª—ã –≤–µ—â–∞–Ω–∏—è –∫–æ—Ç–æ—Ä–æ–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ –Ω–µ–º –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–∞–Ω–∞–ª–∞, –µ—Å–ª–∏ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å –ø—É–±–ª–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª –µ–≥–æ –º–æ–∂–Ω–æ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å
- —Å–æ–∑–¥–∞–µ–º —Å–æ–±—ã—Ç–∏–µ —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä–æ–µ –±—É–¥–µ–º –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ

##### üî∏ –ó–ê–ü–£–°–ö –°–ï–†–í–ï–†–ê
```bash
laravel-echo-server start
php artisan queue:work
```

==–ù–ê–°–¢–†–û–ô–ö–ê –ö–õ–ò–ï–ù–¢–°–ö–û–ô –ß–ê–°–¢–ò==
–≤ —Ñ–∞–π–ª–µ `resources/js/bootstrap.js` –≤ –Ω–∏–∑ –µ—Å—Ç—å –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã–π –ø—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ echo —Å–µ—Ä–≤–µ—Ä–∞ (—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—É—à–µ—Ä–∞)
```js
import Echo from 'laravel-echo';
window.io = require('socket.io-client');

window.Echo = new Echo({
    broadcaster: 'socket.io',
    host: window.location.hostname + ':6001'
});
```

##### üî∏ PRIVATE CHANEL

> –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å routes/channel.php –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–µ—Ç –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∫ –¥–∞–Ω–Ω–æ–º—É –∫–∞–Ω–∞–ª—É (–º–µ—Ç–æ–¥ –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å true)

```php
Broadcast::chanel('room.{id}', function($user, $id) {
	return (int) $user->id === (int) $id
});

// –≥–¥–µ, 'room.{id}' - –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–∞–Ω–∞–ª–∞
```

–≤ –∫–æ–ª–ª–±—ç–∫–µ –≤—Ç–æ—Ä–æ–π –ø–∞—Ä–∞–º–µ—Ç—Ä –¥–æ–ª–∂–µ–Ω —Å–æ–≤–ø–∞–¥–∞—Ç—å (–ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é) —Å –∏–∑–º–µ–Ω–µ—è–µ–º—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –Ω–∞–∑–≤–∞–Ω–∏–∏ –∫–∞–Ω–∞–ª–∞,—Ç.–µ –µ—Å–ª–∏ –∫–∞–Ω–∞–ª –Ω–∞–∑—ã–≤–∞–µ—Ç—å—Å—è `'room.{room_id}'` (`room_id` - –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–∞—Ä–∞–º–µ—Ç—Ä), —Ç–æ –≤ –∫–æ–ª–ª–±–µ–∫ –≤—Ç–æ—Ä—ã–º –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–æ–≤–∞—Ç—å `$room_id`

---
