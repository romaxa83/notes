#php #laravel #testing 

#### ðŸ”¹ Basic use

> Ð¼ÐµÑ‚Ð¾Ð´ `setUp()` Ð² ÐºÐ»Ð°ÑÑÐµ Ñ `unit`-Ñ‚ÐµÑÑ‚Ð°Ð¼Ð¸ Ð±ÑƒÐ´ÐµÑ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒÑÑ Ð¿ÐµÑ€ÐµÐ´ ÐºÐ°Ð¶Ð´Ñ‹Ð¼ Ñ‚ÐµÑÑ‚Ð¾Ð¼

`/** @test */` - Ð°Ð½Ð½Ð¾Ñ‚Ð°Ñ†Ð¸Ñ Ð´ÐµÐ»Ð°ÐµÑ‚ Ð¼ÐµÑ‚Ð¾Ð´ Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐµÐ¼Ñ‹Ð¼ Ñ‚.Ðµ. Ð¿Ð¾Ð·Ð²Ð°Ð»ÑÐµÑ‚ ÑƒÐ±Ñ€Ð°Ñ‚ÑŒ Ð¸Ð· Ð½Ð°Ð·Ð²Ð°Ð½Ð¸Ñ Ð¼ÐµÑ‚Ð¾Ð´Ð° test

`/** @doesNotPerformAssertions */` - Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ñ‡ÐµÑ€ÐµÐ· Ð°Ð½Ð½Ð¾Ñ‚Ð°Ñ†Ð¸ÑŽ Ñ‡Ñ‚Ð¾ Ð½Ð¸Ñ‡ÐµÐ³Ð¾ Ð½Ðµ Ð¿Ñ€Ð¾Ð¸Ð·Ð¾Ð¹Ð´ÐµÑ‚

`/** @expectedException Exception */` - Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ñ‡ÐµÑ€ÐµÐ· Ð°Ð½Ð½Ð¾Ñ‚Ð°Ñ†Ð¸ÑŽ Ñ‡Ñ‚Ð¾ Ð¾Ð¶Ð¸Ð´Ð°ÐµÑ‚ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ

```php
// Ð² Ñ‚ÐµÑÑ‚Ðµ Ð¿ÐµÑ€ÐµÐ¾Ð¿Ñ€ÐµÐ´ÐµÐ»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
\Config::set('firebase.enable_firebase', true);
```
---
#### ðŸ”¹ ÐšÐ¾Ð½ÑÐ¾Ð»ÑŒÐ½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹

```bash
# Ð²Ñ‹Ð²Ð¾Ð´ Ð¿Ð¾Ð¼Ð¾Ñ‰Ð¸ Ð¿Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÑƒ
vendor/bin/phpunit --help

# ÑÐ¾Ð·Ð´Ð°ÑÑ‚ Ñ„Ð°Ð¹Ð» Ð´Ð»Ñ ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
vendor/bin/phpunit --generate-configuration

# Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ñ‹ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð°
vendor/bin/phpunit --filter 'Tests\\Feature\\Queries\\BackOffice\\Companies'

# Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ñ‹ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ Ñ„Ð°Ð¹Ð»Ð° Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ð°
vendor/bin/phpunit --filter 'Tests\\BackOffice\\Companies::success_update'
```
---
#### ðŸ”¹ ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ `phpunit.xml`

- `executionOrder="depends,defects"` - ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ‡Ñ‚Ð¾ ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ð±ÑƒÐ´ÑƒÑ‚ Ð·Ð°Ð¿ÑƒÑ‰ÐµÐ½Ñ‹ Ñ‚ÐµÑÑ‚Ñ‹ Ñ Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚ÑÐ¼Ð¸ Ð° Ð¿Ð¾Ñ‚Ð¾Ð¼ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ ÑƒÐ¿Ð°Ð»Ð¸ Ð² Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰ÐµÐ¼ Ñ‚ÐµÑÑ‚Ðµ
- `cacheResultFile` - ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð¿Ð°Ð¿ÐºÑƒ ÐºÑƒÐ´Ð° Ð±ÑƒÐ´ÐµÐ¼ ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÑ‚ÑŒ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚ Ð¿Ñ€ÐµÐ´Ñ‹Ð´ÑƒÑ‰Ð¸Ñ… Ñ‚ÐµÑÑ‚Ð¾Ð², Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±Ñ‹Ð»Ð¾ Ð¿Ñ€Ð¸ ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐµÐ¼ Ð·Ð°Ð¿ÑƒÑÐºÐµ ,Ð² Ð¿ÐµÑ€Ð²ÑƒÑŽ Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ñ‚Ðµ Ñ‚ÐµÑÑ‚Ñ‹ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð±Ñ‹Ð»Ð¸ Ð¿Ñ€Ð¾Ð²Ð°Ð»ÐµÐ½Ñ‹ Ð¿ÐµÑ€ÐµÐ´ ÑÑ‚Ð¸Ð¼
- `forceCoversAnnotation="true"` - ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÑ‚ Ñ‡Ñ‚Ð¾, ÐµÑÐ»Ð¸ Ð¼Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ð¼ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ‚ÑŒ Ñ Ð°Ð½Ð°Ð»Ð¸Ð·Ð¾Ð¼ Ð¿Ð¾ÐºÑ€Ñ‹Ñ‚Ð¸Ñ Ñ‚Ð¾ ÑÑ‚Ð¸ Ñ‚ÐµÑÑ‚Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ð¾Ð¼ÐµÑ‡ÐµÐ½Ñ‹ Ð°Ð½Ð½Ð¾Ñ‚Ð°Ñ†Ð¸ÐµÐ¹ covers 
---
#### ðŸ”¹ Ð¢ÐµÑÑ‚Ð¾Ð²Ð°Ñ Ð±Ð´

> Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¾Ð² Ð¸Ð¼ÐµÐµÑ‚ ÑÐ¼Ñ‹ÑÐ» Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½ÑƒÑŽ Ð±Ð´ Ð² ÐºÐ¾Ð½Ñ„Ð¸Ð³Ð°Ñ… Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ð±Ð´ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ Ð±Ð´ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¾Ð² Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚ÑŒ Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ð¸ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ Ð±Ð´

```bash
php artisan migrate --database db_testing

# Ð³Ð´Ðµ db_testing - ÐºÐ»ÑŽÑ‡ Ð¼Ð°ÑÑÐ¸Ð²Ð° Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ð¼Ð¸ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ Ð±Ð´ Ð·Ð°Ñ‚ÐµÐ¼ Ð² Ñ„Ð°Ð¹Ð»Ðµ phpunit.xml,Ð³Ð´Ðµ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð°ÑŽÑ‚ÑŒÑÑ env Ð¿Ñ€Ð¾Ð¿Ð¸ÑÐ°Ð²Ð°ÐµÐ¼
```
---
#### ðŸ”¹ ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¹ Ð±Ð´

 > Ñ‡Ñ‚Ð¾Ð± Ð¾Ñ‡Ð¸Ñ‰Ð°Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾ÑÐ»Ðµ Ñ‚ÐµÑÑ‚Ð¾Ð², Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑŒÑÑ Ñ‚Ñ€ÐµÐ¹Ñ‚ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð²ÑÐµ Ð·Ð°Ð¿Ð¸ÑÐ¸ Ð² Ð±Ð´ Ð¾Ð±Ð¾Ñ€Ð°Ñ‡Ð¸Ð²Ð°ÐµÑ‚ Ð² Ñ‚Ñ€Ð°Ð½Ð·Ð°ÐºÑ†Ð¸ÑŽ Ð¸ Ð¿Ð¾ÑÐ»Ðµ Ð¾Ñ‚ÐºÐ°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð¸Ñ…

```php
trait DatabaseTransaction;
```
---
#### ðŸ”¹ ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ¸

```php
// Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð´Ð»Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸
$attributes = [
    'comment' => 'wtf',
    'model_id' => $contract->id,
];

// Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² Ð±Ð´
// Ð³Ð´Ðµ 'reviews',Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ð° Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð¸Ð´ÐµÑ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°
$this->assertDatabaseHas('reviews', $attributes);

// Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ Ð¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ð²Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² Ð±Ð´
$this->assertDatabaseMissing('reviews', $attributes);

// Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÑ‚ ÐºÐ¾Ð»-Ð²Ð¾
$this->assertCount(2, $order->products());
```
---
#### ðŸ”¹ Exception

```php
// Ð²Ñ‹Ð²Ð¾Ð´Ð¸Ñ‚ Ð²ÐµÑÑŒ ÑÑ‚ÐµÐº Ð¾ÑˆÐ¸Ð±Ð¾Ðº
$this->withoutExceptionHandling();

// Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ exception
$this->setExpectedException('Exception');

// Ð¾Ð¶Ð¸Ð´Ð°ÐµÐ¼ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ (ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ Ð¿ÐµÑ€ÐµÐ´ Ð·Ð°Ð¿ÑƒÑÐºÐ¾Ð¼ ÐºÐ°ÐºÐ¾Ð¹-Ñ‚Ð¾ Ð»Ð¾Ð³Ð¸ÐºÐ¸, Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¹ Ð´Ð¾Ð»Ð¶Ð½Ð¾ Ð²Ñ‹Ð»ÐµÑ‚ÐµÑ‚ÑŒ Ð¸ÑÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ)
$this->expectException(\InvalidArgumentException::class);
```
---
#### ðŸ”¹ ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Event

```php
// Ð² Ð½Ð°Ñ‡Ð°Ð»Ðµ Ñ‚ÐµÑÑ‚Ð° ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ñ„ÐµÐ¹ÐºÐ¾Ð²Ð¾Ðµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ
\Event::fake([CreateUser::class]);

// Ð·Ð°Ñ‚ÐµÐ¼ Ð´ÐµÐ»Ð°ÐµÐ¼ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸

// Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°, Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»Ð¾ÑÑŒ Ð»Ð¸ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ
\Event::assertDispatched(CreateUser::class);

// Ñ‡ÐµÑ€ÐµÐ· callback Ð¼Ð¾Ð¶Ð½Ð¾ Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð±Ð¾Ð»ÐµÐµ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸, (ÐµÑÑ‚ÑŒ Ð»Ð¸ Ð½ÑƒÐ¶Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð² ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¸) 
\Event::assertDispatched(function (CreateUser $event) use ($user) {
    return $event->user->id === $user->id;
});
// Ð² ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ð²ÐµÑ€ÑÐ¸ÑÑ… ,Ñ‚Ð°Ðº
\Event::assertDispatched(FcmPushGroup::class, function ($event) use ($rep_1){
    return $event->report->id === $rep_1->id && $event->templateName == FcmTemplate::PLANNED;
});

// Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°, ÐºÐ°ÐºÐ¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð» ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ
\Event::assertListening(CreateUser::class, SingUpListeners::class);

// Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡Ñ‚Ð¾ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÑ‚Ð¸Ð»Ð¾ÑÑŒ
\Event::assertNotDispatched(FcmPushGroup::class);

// Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°, ÑÐºÐ¾Ð»ÑŒÐºÐ¾ Ñ€Ð°Ð· Ð·Ð°Ð¿ÑƒÑÐºÐ°Ð»Ð¾ÑÑŒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ
\Event::assertDispatchedTimes(FcmPushGroup::class, 3);
```
---
#### ðŸ”¹ ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Job

```php
// ÐµÑÐ»Ð¸ Ð² Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼Ð¾Ð¼ Ð¼ÐµÑ‚Ð¾Ð´Ðµ ÐµÑÑ‚ÑŒ Ñ‚Ð°ÐºÐ°Ñ Ð´Ð¶Ð¾Ð±Ð°
MailSendJob::dispatch(['user' => $user]);

// Ñ‡Ñ‚Ð¾Ð± Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¼ÐµÑ‚Ð¾Ð´ Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ñ Ð´Ð¶Ð¾Ð±Ñƒ, Ð² ÑÐ°Ð¼Ð¾Ð¼ Ñ‚ÐµÑÑ‚Ðµ Ð¿Ñ€Ð¾Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ 
\Queue::fake();

// Ñ‚Ð°Ðº Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÑ‚ÑŒ Ð±Ð¾Ð»ÐµÐµ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ð¾ Ð¾Ñ‡ÐµÑ€ÐµÐ´ÑŒ
Queue::assertPushed(PhotoUploadJob::class, function ($job) {
    return $job->resource instanceof Model;
});
```
---
#### ðŸ”¹ Stub

> ÑÐ¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ñ‹ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð¸Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²

```php
// ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð·Ð°Ð³Ð»ÑƒÑˆÐºÑƒ, Ð¿ÐµÑ€ÐµÐ´Ð°ÐµÐ¼ ÐºÐ»Ð°ÑÑ Ð² ÐºÐ¾Ñ‚Ð¾Ñ€Ð¾Ð¼ Ð·Ð°Ð¿Ñ€Ð°ÑˆÐ¸Ð²Ð°ÑŽÑ‚ÑŒÑÑ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÐ¾ ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð¸Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
$sender = $this->createStub(RequestClient::class);

// ÑƒÐºÐ°Ð·Ñ‹Ð²Ð°ÐµÐ¼ ÐºÐ°ÐºÐ¾Ð¹ Ð¼ÐµÑ‚Ð¾Ð´ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð¾Ñ‚Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ñ‚ÑŒ, Ð¸ ÐºÐ°ÐºÐ¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ð½ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð²ÐµÑ€Ð½ÑƒÑ‚ÑŒ
$sender->method('postRequest')->willReturn(['data' => 'some data']);

// Ð·Ð°Ñ‚ÐµÐ¼ ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ ÐºÐ»Ð°ÑÑ, ÐºÑƒÐ´Ð° Ð¸Ð½Ð¶ÐµÐºÑ‚Ð¸Ñ‚ÑÑ RequestClient Ð¸ Ð¿Ñ€Ð¾ÐºÐ¸Ð´Ð²Ð°ÐµÐ¼ ÐµÐ¼Ñƒ Ð½Ð°Ñˆ sender Ð²Ð½ÑƒÑ‚Ñ€Ð¸ Ð¾Ñ‚Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ÑƒÐºÐ°Ð·Ð°Ð½Ñ‹Ð¹ Ð½Ð°Ð¼Ð¸ Ð¼ÐµÑ‚Ð¾Ð´, Ð¸ Ð²ÐµÑ€Ð½ÐµÑ‚ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ðµ Ð¼Ñ‹ ÐµÐ¼Ñƒ Ð¿ÐµÑ€ÐµÐ´Ð°Ð»Ð¸

// Ð•ÑÐ»Ð¸ Ð¼ÐµÑ‚Ð¾Ð´ ÐºÐ¾Ñ‚Ð¾Ñ€Ñ‹Ð¹ Ð¼Ñ‹ Ñ…Ð¾Ñ‚Ð¸Ð¼ Ð²Ñ‹Ð·Ð²Ð°Ñ‚ÑŒ, Ð° Ð¾Ð½ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ ÐºÐ°ÐºÐ¸Ðµ-Ñ‚Ð¾ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹, Ð¸ Ð½Ð° Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€Ñ‹ Ð²Ð¾Ð·Ð²Ñ€Ð°Ñ‰Ð°ÐµÑ‚ Ñ€Ð°Ð·Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ, Ñ‚Ð¾ Ð¼Ð¾Ð¶Ð½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ñ‚Ð°ÐºÑƒÑŽ ÐºÐ¾Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑŽ

$clientStub = $this->createStub(\Zadarma_API\Api::class);
$clientStub->method('getPbxStatus')
    ->will($this->returnCallback(function ($id) {
        switch ($id) {
            case 101:
                return [
                    'number' => 101,
                    'is_online' => 'true'
                ];
            case 102:
                return [
                    'number' => 102,
                    'is_online' => 'true'
                ];
            case 103:
                return [
                    'number' => 103,
                    'is_online' => 'false'
                ];
            default:
                return ['status' => 'unknown', 'id' => $id];
        }
    }));

// Ð² Ð·Ð°Ð²Ð¸ÑÐ¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¾Ñ‚ Ñ‚Ð¾Ð³Ð¾ ÐºÐ°ÐºÐ¾Ð¹ Ð¿Ð°Ñ€Ð°Ð¼ÐµÑ‚Ñ€ Ð±ÑƒÐ´ÐµÑ‚ Ð¿ÐµÑ€ÐµÐ´Ð°Ð½ Ð² Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ getPbxStatus, Ñ‚Ð°ÐºÐ¾Ð¹ Ð¸ Ð±ÑƒÐ´ÐµÑ‚ Ð¾Ñ‚Ð²ÐµÑ‚
```
---
#### ðŸ”¹ Ð¤ÐµÐ¹ÐºÐ¾Ð²Ñ‹Ð¹ http - Ð·Ð°Ð¿Ñ€Ð¾Ñ

```php
// Ñ‚Ð°Ðº Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐ¼ÑƒÐ»Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð·Ð°Ð¿Ñ€Ð¾Ñ Ð½Ð° ÑÑ‚Ð¾Ñ€Ð¾Ð½Ð¸Ð¸ ÑÐµÑ€Ð²Ð¸ÑÑ‹

\Http::fake(['*' => \Http::response([
    'data' => GetInvoice::testData()
])]);
```
---
#### ðŸ”¹ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ñ„Ð°Ð¹Ð»Ð¾Ð²

```php
// Ñ‚Ð°Ðº Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ„ÐµÐ¹ÐºÐ¾Ð²Ñ‹Ð¹ Ñ„Ð°Ð¹Ð»
Illuminate\Http\UploadedFile::fake()->image(Image::OTHERS."test.jpg")

// Ð¸Ð»Ð¸ Ñ‚Ð°Ðº
$sizeInKilobytes = 100000;
$file = UploadedFile::fake()->create(
    'video.mp4', $sizeInKilobytes, 'mp4'
);

// Ñ‚Ð°Ðº Ð¼Ð¾Ð¶Ð½Ð¾ ÑÐ¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ„ÐµÐ¹ÐºÐ¾Ð²Ñ‹ ÑÑ‚Ð¾Ñ€Ð°Ð´Ð¶, Ñ‡Ñ‚Ð¾Ð± Ð½Ðµ Ð·Ð°Ñ…Ð»Ð¾Ð¼Ð»ÑÑ‚ÑŒ Ñ€ÐµÐ°Ð»ÑŒÐ½Ñ‹Ð¹ Ð¿Ñ€Ð¸ Ñ‚ÐµÑÑ‚Ð°Ñ… 
Illuminate\Support\Facades\Storage::fake('public');

// Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° Ð² ÑÑ‚Ð¾Ñ€Ð°Ð´Ð¶Ðµ
Storage::disk('public')->assertExists($url);

// Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ñ‡Ñ‚Ð¾ Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð½ÐµÑ‚ Ð² ÑÑ‚Ð¾Ñ€Ð°Ð´Ð¶Ðµ
Storage::disk('public')->assertMissing([
    $url
]);
```
---
#### ðŸ”¹ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ

```php
// ÐµÑÐ»Ð¸ Ð½ÑƒÐ¶Ð½Ð¾ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÑÑƒÑ‰Ð½Ð¾ÑÑ‚Ð¸ ÑÐ¾ Ð²Ñ€ÐµÐ¼ÐµÐ½ÐµÐ¼ Ð¼Ð¾Ð¶Ð½Ð¾ ÑƒÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°Ñ‚ÑŒ Ñ€Ð°Ð·Ð»Ð¸Ñ‡Ð½Ð¾Ðµ Ð²Ñ€ÐµÐ¼Ñ Ð² Ñ€Ð°Ð¼ÐºÐ°Ñ… Ð¾Ð´Ð½Ð¾Ð³Ð¾ Ñ‚ÐµÑÑ‚Ð° 

CarbonImmutable::setTestNow(Carbon::now()->addDay());
```
---
#### ðŸ”¹ Ð¢ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Notification

```php
// Ñ„ÐµÐ¹ÐºÐ¾Ð²Ñ‹ Ð½Ð¾Ñ‚Ð¸Ñ„Ð¸ÐºÐ°Ñ‚Ð¸Ð¾Ð½
Notification::fake();

// Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ Ñ‚Ð°ÐºÐ¾Ð³Ð¾ Ð¼ÐµÑ‚Ð¾Ð´Ð° (Ð² Ñ€Ð°Ð±Ð¾Ñ‡ÐµÐ¼ ÐºÐ¾Ð´Ðµ)
\Notification::route('mail', $report->client_email)
                ->notify(new SendReport($this->getUrlForPdf($title)));

// Ð² Ñ‚ÐµÑÑ‚Ð¾Ð²Ð¾Ð¼ Ð¼ÐµÑ‚Ð¾Ð´Ðµ
 Notification::assertSentTo(new AnonymousNotifiable(), SendReport::class,
    function ($notification, $channels, $notifiable) use ($report) {
        return $notifiable->routes['mail'] == $report->client_email;
    }
);
```
---
#### ðŸ”¹ ÐŸÐ Ð˜ÐœÐ•Ð  ÐºÐ°Ðº Ð¼Ð¾Ð¶Ð½Ð¾ Ð¿Ñ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð² schedule

```php
public function testIsAvailableInTheScheduler()
{
    /** @var \Illuminate\Console\Scheduling\Schedule $schedule */
    $schedule = app()->make(\Illuminate\Console\Scheduling\Schedule::class);

    $events = collect($schedule->events())->filter(function (\Illuminate\Console\Scheduling\Event $event) {
        return stripos($event->command, 'YourCommandHere');
    });

    if ($events->count() == 0) {
        $this->fail('No events found');
    }

    $events->each(function (\Illuminate\Console\Scheduling\Event $event) {
        // This example is for hourly commands.
        $this->assertEquals('0 * * * * *', $event->expression);
    });
}
```
---
#### ðŸ”¹ Ð—Ð°Ð¿ÑƒÑÐº ÐºÐ¾Ð½ÑÐ¾Ð»ÑŒÐ½Ñ‹Ñ… ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð´Ð»Ñ Ñ‚ÐµÑÑ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ

```php
$this->artisan('cmd:test');
// Ð² ÑÑ‚Ð°Ñ€Ð¾Ð¹ Ð²ÐµÑ€ÑÐ¸Ð¸ Ð»Ð°Ñ€Ð°Ð²ÐµÐ»
$this->artisan('cmd:test')->run();

// Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÐ¼ Ð¸ ÑÑ€Ð°Ð·Ñƒ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ñ‡Ñ‚Ð¾ Ð·Ð°ÐºÐ¾Ð½Ñ‡Ð¸Ð»Ð°ÑÑŒ Ñ…Ð¾Ñ€Ð¾ÑˆÐ¾
$this->artisan('cmd:test')->assertExitCode(0);
```
---
#### ðŸ”¹ Mock

- https://laravel.su/docs/8.x/mocking
---


