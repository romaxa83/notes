#php #psr
**[PSR-12](https://www.php-fig.org/psr/psr-12)** — это стандарт кодирования PHP, разработанный PHP-FIG (**PHP Framework Interoperability Group**). Он основан на **[PSR-1](/notes/33)** (Базовые принципы) и **[PSR-2](/notes/85)** (Руководство по стилю кода), но улучшает и дополняет эти стандарты, предоставляя более строгие и современные правила для написания чистого, читаемого и поддерживаемого кода.

#### Основные положения PSR-12

PSR-12 фокусируется на:
1. Именовании сущностей.
2. Стандартизации отступов, пробелов, переносов строк.
3. Оформлении блоков кода, функций, классов и методов.
4. Использовании современной функциональности PHP.

#### Основные правила PSR-12

##### **Базовые правила (от PSR-1)**
- Файлы должны быть в кодировке **UTF-8 без BOM**.
- Каждый файл должен содержать только одно пространство имён и одну (опциональную) структуру из классов, интерфейсов или трейтов.
- Имена классов должны следовать правилам **CamelCase**.
- Константы должны именоваться в стиле **UPPER_CASE_WITH_UNDERSCORES**.
- Методы и функции должны именоваться в стиле **camelCase**.

##### **Структура файла**
1. Открывающий PHP-тег `<?php` **должен быть первым элементом в файле**.
```php
<?php
```

2. После открывающего PHP-тега не должно быть пустых строк.

3. Код должен импортировать только нужные конструкции через `use` в одном логическом блоке:

```php
use Vendor\Package\ClassName;
use Vendor\Package\OtherClassName;
```

4. Импорты **должны идти сразу после объявления пространства имён**.

##### **Отступы и пробелы**
1. Используются только пробелы (не табуляция): один отступ равен **4 пробелам**.

```php
if ($condition) {
    // Отступ 4 пробела
    echo "PSR-12";
}
```

2. После ключевого слова управления внутри условного блока всегда добавляются **один пробел**:

```php
if ($condition) {
    // Код
}
```

##### **Строки**
1. Для переноса строк используется **LF** (Unix-style), а не CR или CRLF (Windows-style).
2. Каждая новая строка должна быть `LF`, включая последнюю строку файла.


##### **Переменные, методы и скобки**
1. **Скобки** между выражениями/условиями:
   - Открывающая скобка всегда на той же строке.
   - Между ключевыми словами и скобками — пробел.
  
```php
if ($a && $b) {
    // Код
}
```

2. **Фигурные скобки**:
   - Начальная фигурная скобка на той же строке (`K&R style`).
   - Закрывающая фигурная скобка на новой строке.
   
```php
if ($condition) {
    // Блок условий
} else {
    // Альтернативный блок
}
```

3. **Методы и функции**:
   - Между именем функции и скобками нет пробелов:
  
```php
function doSomething(string $param): string
{
    return $param;
}
```

##### **Типы данных и типизация**
1. PHP с типизацией:
   - Все аргументы и возвращаемые типы функций **должны быть типизированы**, если это возможно.

```php
function sum(int $a, int $b): int
{
    return $a + $b;
}
```

2. Для аргументов позволяют использовать **nullable-типы**, если это уместно:

```php
function getItem(?string $param): ?string
{
    return $param;
}
```

3. Указание типа возвращаемых данных является **обязательным**.

##### **Длинные строки и сложные выражения**
1. Если выражение слишком длинное для одной строки, перенос выполняется с сохранением отступов:

```php
$query = $queryBuilder
    ->select('u.name', 'u.email', 'u.created_at')
    ->from('users', 'u')
    ->where('u.active = 1')
    ->orderBy('u.created_at', 'DESC');
```

2. Массивы:
   - Каждый элемент массива — на новой строке.
 
```php
$array = [
    'first' => 'One',
    'second' => 'Two',
    'third' => 'Three',
];
```

##### **Имена классов, методов и переменных**
1. Имена классов, интерфейсов и трейтов должны следовать **CamelCase**:

```php
class MyExampleClass {}
```

2. Имена методов и переменных — в **camelCase**:

```php
function myMethodName()
{
    $myVariable = 10;
}
```

3. Константы в **UPPERCASE_WITH_UNDERSCORES**:

```php
const MAX_USER_COUNT = 100;
```

##### **Шаблоны использования PSR-12**
PSR-12 позволяет поддерживать код в единообразной и читаемой форме. Например:

```php
<?php

declare(strict_types=1);

namespace App\Services;

use App\Models\User;
use App\Repositories\UserRepository;

class UserService
{
    private UserRepository $userRepository;

    public function __construct(UserRepository $userRepository)
    {
        $this->userRepository = $userRepository;
    }

    public function getUserData(int $userId): array
    {
        $user = $this->userRepository->find($userId);

        if (!$user) {
            throw new \InvalidArgumentException('User not found.');
        }

        return [
            'id' => $user->id,
            'name' => $user->name,
            'email' => $user->email,
        ];
    }
}
```

---

#### Итоги
**PSR-12** помогает сделать код единообразным, удобным для чтения и соответствующим современным стандартам PHP. Ключевые пункты:
- Отступы в 4 пробела.
- Типизация обязательна (где возможно).
- Строгая структура файлов.
- Читабельный, красиво форматированный и поддерживаемый код.

Инструменты вроде `PHP-CS-Fixer` или `PHP_CodeSniffer` помогут автоматически приводить код к стандарту PSR-12.