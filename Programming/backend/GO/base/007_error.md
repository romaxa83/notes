#go #erorr

#### üîπ Info

–û—à–∏–±–∫–∏ –≤ `Go` –Ω–µ –ø–æ—Ö–æ–∂–∏ –Ω–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –∏–ª–∏ –æ—à–∏–±–∫–∏ –≤ –¥—Ä—É–≥–∏—Ö —è–∑—ã–∫–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è; —ç—Ç–æ –æ–±—ã—á–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã `Go`, –∫–æ—Ç–æ—Ä—ã–µ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –∏–∑ —Ñ—É–Ω–∫—Ü–∏–π –∏–ª–∏ –º–µ—Ç–æ–¥–æ–≤, –ø–æ–¥–æ–±–Ω–æ –ª—é–±—ã–º –¥—Ä—É–≥–∏–º –∑–Ω–∞—á–µ–Ω–∏—è–º. ==–û—à–∏–±–∫–∏ –≤ go —ç—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å==.

```go
type error interface {
	Error() string
}
```

–ª—é–±–æ–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ç–æ–¥—ã —ç—Ç–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, –º–æ–∂–µ—Ç –≤—ã—Å—Ç—É–ø–∞—Ç—å –≤ –∫–∞—á–µ—Å—Ç–≤–µ –æ—à–∏–±–∫–∏

```go
// –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö –æ—à–∏–±–∫–∏

err := errors.New("Error message")
println(err.Error())

// –∏–ª–∏

err := fmt.Errorf("unsupported type: %T", v)

// —Ç–∞–∫ –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ü–µ–ø–æ—á–∫—É –æ—à–∏–±–æ–∫, —Ç.–µ. –≤–∫–ª–∞–¥—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏
err := fmt.Errorf("wrapped error: %x", firstErr)

// –ø–æ–ª—É—á–µ–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–π –æ—à—Ç–±–∫–∏
prevErr = error.Unwrap(currentErr)

// –¢–∞–∫ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—à–∏–±–∫–∏
if err.Error() == "Error message" {
	fmt.Println("!!")
}
```

—è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ `err` - –æ—à–∏–±–∫–æ–π –∫–æ—Ç–æ—Ä–∞—è –ª–µ–∂–∏—Ç –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `target`, —Ç.–µ. –ø—Ä–æ–±–µ–≥–∞–µ–º—Å—è –ø–æ –≤—Å–µ–π —Ü–µ–ø–æ—á–∫–∏ –æ—à–∏–±–æ–∫ –≤ –ø–µ—Ä–µ–º–µ–Ω–æ–π err –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞–µ–º —Å –æ—à–∏–±–∫–æ–π –∏–∑
–ø–µ—Ä–µ–º–µ–Ω–æ–π `target`, –µ—Å–ª–∏ —Ö–æ—Ç—å –æ–¥–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —Å–æ–≤–ø–∞–¥–∞–µ—Ç, —Ç–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—à–ª–∞
```go
if !errors.Is(err, target) {}

// –ø—Ä–æ–≤–µ—Ä—è–µ–º —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—à–∏–±–∫–∞ –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞
if !errors.As(err, new(*ImportMissingError)) {}
```
---
#### üîπ –ü—Ä–∏–º–µ—Ä (–ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Å–≤–æ–µ–π –æ—à–∏–±–∫–∏)

```go
// —Å–æ–∑–¥–∞–µ–º —Å–≤–æ—é –æ—à–∏–±–∫—É
type ServerError struct {
	err error
}
// —Ä–µ–∞–ª–∏–∑—É–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Error
func (s *ServerError) Error() string {
	return s.err.Error()
}

func NewServerError(msg string) error {
	return &ServerError{
		err: errors.New(msg)
	}
}

// —Å–æ–∑–¥–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω—é—é –æ—à–∏–±–∫—É
var internalErr = NewServerError("–≤–Ω—É—Ç—Ä–µ–Ω—è—è –æ—à–∏–±–∫–∞")

func getClient() (client.Client, error) {
	cl := client.Client{}
	// —Å–æ–∑–¥–∞–Ω–∏–µ –≤–ª–æ–∂–µ–Ω–Ω–æ–π –æ—à–∏–±–∫–∏
	err := fmt.Errorf("–æ—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–∞: %w", internalErr)
	return cl, err
}

func main() {
	res, err := getClient()
	if err != nil {
		// —Ç.–∫. —É –Ω–∞—Å –≤–ª–æ–∂–µ–Ω–∞—è –æ—à–∏–±–∫–∞, –º–æ–∂–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
		// –¥–∞–Ω–Ω—É—é –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
		if errors.Is(err, internalErr) {
			fmt.Println("internal error")
		}
		// —Ä–∞—Å–ø–∞–∫–æ–≤—ã–≤–∞–µ–º –≤–Ω—É—Ç—Ä–µ–Ω–∏–∏ –æ—à–∏–±–∫–∏, —Ç.–µ. –≤–µ—Ä–Ω–µ—Ç –≤–ª–æ–∂–µ–Ω—É—é –æ—à–∏–±–∫—É
		// –µ—Å–ª–∏ –µ–µ –Ω–µ—Ç, —Ç–æ –≤–µ—Ä–Ω–µ—Ç nil
		newWrapErr := errors.Unwrap(err)
		fmt.Println(newWrapErr)

		fmt.Println(err.Error())
	}
	fmt.Println(res)
}
```
---
#### üîπ Defer

–∫.—Å. `defer` –º–æ–∂–µ—Ç –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω ¬´–≤ –ª—é–±–æ–º —Å–ª—É—á–∞–µ¬ª, –æ–±—ã—á–Ω–æ –æ–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ–¥–∞, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω –¥–∞–∂–µ –≤ —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏.(—á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∑–∞–∫—Ä—ã—Ç–∏—è —Ñ–∞–π–ª–æ–≤)

---
#### üîπ Defer Panic/recover

`Panic` - –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è —Å–æ–∑–¥–∞–µ—Ç –æ—à–∏–±–∫—É —Ä–∞–Ω—Ç–∞–π–º–∞. –ö–æ–≥–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø–∞–Ω–∏–∫–∞, —Ç–µ–∫—É—â–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–≤–æ–¥–∏—Ç 
—Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –∞–≤–∞—Ä–∏–π–Ω–æ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è

```go
// —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –ø–∞–Ω–∏–∫–∏
panic("Panic")
```

==–ü–∞–Ω–∏–∫–∞ –≤ go –Ω–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –∏ –µ–µ –Ω–µ —Å—Ç–æ–∏—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ==

–ö–æ–≥–¥–∞ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç —Å–∏—Ç—É–∞—Ü–∏—è –ø–∞–Ω–∏–∫–∏, –≤ –≤—ã–≤–æ–¥ –≤–∫–ª—é—á–∞–µ—Ç—Å—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∞ —Å—Ç–µ–∫–∞, –∏–ª–∏ –ø–µ—Ä–µ—á–µ–Ω—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ —Å—Ç–µ–∫–∞ –≤—ã–∑–æ–≤–æ–≤. –≠—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∏—á–∏–Ω, –≤—ã–∑–≤–∞–≤—à–∏—Ö –∞–≤–∞—Ä–∏–π–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

```go
func main() {
	one()
}
func one() {
	two()
}
func two() {
	three()
}
func three() {
	panic("PANIC")
}
```

–ù–æ –µ—Å–ª–∏ —Ç–∞–∫–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –Ω–µ –Ω—É–∂–Ω–æ –¥–ª—è `panic` `Go` –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é `recover`, –∫–æ—Ç–æ—Ä–∞—è –ø–æ–º–æ–∂–µ—Ç –∏–∑–±–µ–∂–∞—Ç—å –ø–∞–Ω–∏–∫–∏ –≤ –ø—Ä–æ–≥—Ä–∞–º–º–µ.

> –ü—Ä–∏ –≤—ã–∑–æ–≤–µ `recover` –≤–æ –≤—Ä–µ–º—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã (–≤ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ –≤–æ–∑–Ω–∏–∫–ª–∞ –ø–∞–Ω–∏–∫–∞) —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `nil` –∏ –±–æ–ª—å—à–µ –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ—Ç, –µ—Å–ª–∏ –ø–∞–Ω–∏–∫–∞ –≤–æ–∑–Ω–∏–∫–ª–∞, —Ñ—É–∫–Ω—Ü–∏—è –µ–µ –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç, –∏ –≤–µ—Ä–Ω–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞–Ω–∏–∫–∏. –ù–æ –∫–æ–≥–¥–∞ –≤—ã –≤—ã–∑—ã–≤–∞–µ—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é `panic` –≤ —Ñ—É–Ω–∫—Ü–∏–∏, —ç—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Å—Ç–∞–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, –≤—ã–∑—ã–≤–∞—Ç—å `recover` –≤ –æ–¥–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å `panic` –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ, –ø–æ—Ç–æ–º—É —á—Ç–æ –ø–∞–Ω–∏–∫–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è, —á—Ç–æ–± –Ω–æ—Ä–º–∞–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å recover, –µ–µ –Ω—É–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `defer` –ø—Ä–∏ –≤—ã–∑–æ–≤–µ —ç—Ç–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –ø–µ—Ä–µ–¥ –∫–æ–¥–æ–º, –≤ –∫–æ—Ç–æ—Ä–æ–º –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –ø–∞–Ω–∏–∫–∞.

```go
func calmDown() {
	recover()
}

func freakOut() {
	defer calmDown()
	panic("oh no")
}

func main() {
	freakOut()
	fmt.Println("Exiting normally")
}
```

–í—ã–∑–æ–≤ `recover` –Ω–µ –ø—Ä–∏–≤–µ–¥–µ—Ç –∫ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—é –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã —Å –º–µ—Å—Ç–∞ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –ø–∞–Ω–∏–∫–∏, –ø–æ –∫—Ä–∞–π–Ω–µ–π –º–µ—Ä–µ –∏–º–µ–Ω–Ω–æ —Å —Ç–æ–≥–æ –º–µ—Å—Ç–∞. –§—É–Ω–∫—Ü–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –≤–æ–∑–Ω–∏–∫–ª–∞ –ø–∞–Ω–∏–∫–∞, –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –∏ –Ω–∏–∫–∞–∫–æ–π –∫–æ–¥ –≤ –±–ª–æ–∫–µ —ç—Ç–æ–π
—Ñ—É–Ω–∫—Ü–∏–∏, —Å–ª–µ–¥—É—é—â–∏–π –∑–∞ –º–µ—Å—Ç–æ–º –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏—è –ø–∞–Ω–∏–∫–∏, –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –Ω–µ –±—É–¥–µ—Ç.–û–¥–Ω–∞–∫–æ –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏—è, –≤ –∫–æ—Ç–æ—Ä–æ–π –≤–æ–∑–Ω–∏–∫–ª–∞ –ø–∞–Ω–∏–∫–∞, –≤–µ—Ä–Ω–µ—Ç —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—Å—è –Ω–æ—Ä–º–∞–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã.

---
#### üîπ –ü—Ä–∏–º–µ—Ä —Å panic/recover

```go
func foo() {
	panic("Panic")
}


func main() {
	defer func() {
		err := recover()
		fmt.Println("Don't panic")
		fmt.Println(err)
	}()

	fmt.Println("start")
	foo()
	fmt.Println("end")
}
```
---
#### üîπ –í—ã–∑–æ–≤ –æ—à–∏–±–∫–∏

> –í –ø–∞–∫–µ—Ç–∞—Ö `fmt` –∏ `log` –º–æ–∂–Ω–æ –Ω–µ –≤—ã–∑—ã–≤–∞—Ç—å `Error()`, –æ–Ω–∏ —ç—Ç–æ –¥–µ–ª–∞—é—Ç —Å–∞–º–∏ , —Ç.–µ.

```go
fmt.Println(err)
log.Fatal(err)

```
---

