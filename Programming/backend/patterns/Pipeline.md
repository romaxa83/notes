#pattern #architecture #php 
**Pipeline** ‚Äî —ç—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π —à–∞–±–ª–æ–Ω –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —ç—Ç–∞–ø–æ–≤ (–∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤). –ö–∞–∂–¥—ã–π —ç—Ç–∞–ø –±–µ—Ä–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –¥–∞–Ω–Ω—ã–µ, –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∏—Ö –∏ –ø–µ—Ä–µ–¥–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Å–ª–µ–¥—É—é—â–µ–º—É —ç—Ç–∞–ø—É. –≠—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω —à–∏—Ä–æ–∫–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥–∏–±–∫–æ–π –∏ –ª–µ–≥–∫–æ —Ä–∞—Å—à–∏—Ä—è–µ–º–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

---

#### –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω Pipeline
–≠—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –ø–æ–ª–µ–∑–µ–Ω, –µ—Å–ª–∏: 
* üîπ –ï—Å—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —à–∞–≥–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö, –∫–æ—Ç–æ—Ä—É—é –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å.
* üîπ –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è—Ç—å, —É–±–∏—Ä–∞—Ç—å –∏–ª–∏ –∏–∑–º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —à–∞–≥–æ–≤ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–¥–∞.
* üîπ –ù—É–∂–Ω–æ —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –¥–∞–Ω–Ω—ã—Ö –∏ —Å–¥–µ–ª–∞—Ç—å –∫–æ–¥ –±–æ–ª–µ–µ —á–∏—Ç–∞–µ–º—ã–º –∏ –º–æ–¥—É–ª—å–Ω—ã–º.
* üîπ –¢—Ä–µ–±—É–µ—Ç—Å—è –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —à–∞–≥–æ–≤ (–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤) –≤ —Ä–∞–∑–Ω—ã—Ö –º–µ—Å—Ç–∞—Ö –ø—Ä–æ–≥—Ä–∞–º–º—ã.

#### –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–∞—Ç—Ç–µ—Ä–Ω–∞ Pipelin
* üîπ **–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞**: –®–∞–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —á–µ—Ç–∫–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω—ã, –∫–∞–∂–¥—ã–π —à–∞–≥ –∏–Ω–∫–∞–ø—Å—É–ª–∏—Ä—É–µ—Ç —Å–≤–æ—é –ª–æ–≥–∏–∫—É.
* üîπ **–†–∞—Å—à–∏—Ä—è–µ–º–æ—Å—Ç—å**: –ß—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π —ç—Ç–∞–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏, –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å –µ–≥–æ –≤ –∫–æ–Ω–≤–µ–π–µ—Ä.
* üîπ **–ú–æ–¥—É–ª—å–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –∏ –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ.
* üîπ **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–æ—Å—Ç—å**: –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö –∫–æ–Ω–≤–µ–π–µ—Ä–∞—Ö –∏–ª–∏ —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö.
	
#### –°—É—Ç—å –ø–∞—Ç—Ç–µ—Ä–Ω
üîπ **–®–∞–≥–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (Stages/Handlers)**: –ö–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ä–µ–∞–ª–∏–∑—É–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –æ–ø–µ—Ä–∞—Ü–∏—é –Ω–∞–¥ –¥–∞–Ω–Ω—ã–º–∏.
üîπ **–ö–æ–Ω–≤–µ–π–µ—Ä (Pipeline)**: –ü—Ä–æ—Ö–æ–¥ –ø–æ —Ü–µ–ø–æ—á–∫–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤, –≥–¥–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç —Ä–∞–±–æ—Ç—ã –æ–¥–Ω–æ–≥–æ —à–∞–≥–∞ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–µ–º—É.
üîπ **–ì–∏–±–∫–æ—Å—Ç—å**: –õ–µ–≥–∫–æ –¥–æ–±–∞–≤–ª—è—Ç—å, –∏–∑–º–µ–Ω—è—Ç—å –∏–ª–∏ —É–¥–∞–ª—è—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏, –Ω–µ –≤–º–µ—à–∏–≤–∞—è—Å—å –≤ –æ—Å–Ω–æ–≤–Ω–æ–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏.

#### –ü—Ä–∏–º–µ—Ä:

**–ø—Ä–æ—Å—Ç–æ–π –∫–æ–Ω–≤–µ–π–µ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö**

```php
// –∫–∞–∂–¥—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫(—ç—Ç–∞–ø –æ–±—Ä–∞–±–æ—Ç–∫–∏) –¥–æ–ª–∂–µ–Ω —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Handler
interface Handler
{
    public function handle($payload);
}

// –ö–ª–∞—Å—Å—ã-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (Concrete Handlers), –∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
class AddPrefixHandler implements Handler
{
    public function handle($payload)
    {
        return "Prefix: " . $payload;
    }

}

class AddSuffixHandler implements Handler
{
    public function handle($payload)
    {
        return $payload . " :Suffix";
    }
}

// –°–∞–º Pipeline –∑–¥–µ—Å—å —Å–æ–¥–µ—Ä–∂–∏—Ç—Å—è –ª–æ–≥–∏–∫–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.
class Pipeline
{
    private array $handlers = [];
    public function pipe(Handler $handler): self
    {
        $this->handlers[] = $handler;
        return $this;
    }

    public function process($payload)
    {
        foreach ($this->handlers as $handler) {
            $payload = $handler->handle($payload);
        }

        return $payload;
    }
}

// –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Pipeline
$pipeline = new Pipeline();

$pipeline
    ->pipe(new AddPrefixHandler())
    ->pipe(new AddSuffixHandler());

$result = $pipeline->process("Data");
echo $result; // "Prefix: Data :Suffix"
```


**–ü—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ç–µ–∫—Å—Ç–∞**
*–∑–¥–µ—Å—å —Å–æ–∑–¥–∞–µ—Ç—Å—è payload —Å –¥–∞–Ω–Ω—ã–º–∏ –æ —Ç–µ–∫—Å—Ç–µ* 

```php
namespace App\Services\TextProcess;

final class TextPayload
{
    public string $rawText;
    public string $processedText;
    public array $links = [];
    public array $blocks = [];

    public function __construct(string $text)
    {
        $this->rawText = $text;
        $this->processedText = '';
    }
}
```

*–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤*

```php
namespace App\Services\TextProcess;

interface TextProcessorHandler
{
    public function handle(TextPayload $payload): TextPayload;
}
```

*–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏*

```php
namespace App\Services\TextProcess\Handlers;

use App\Services\TextProcess\TextPayload;
use App\Services\TextProcess\TextProcessorHandler;

final class GetLinks implements TextProcessorHandler
{
    public function handle(TextPayload $payload): TextPayload
    {
        // –≤ —Ç–µ–∫—Å—Ç –¥–æ–±–∞–≤–ª—è–µ–º –ª–∏–Ω–∫–∞–º –∫–ª–∞—Å—Å
        $payload->processedText = $this->addClassIntoText($payload->originalText);
        // –ø–æ–ª—É—á–∞–µ–º –≤—Å–µ –ª–∏–Ω–∫–∏ –∏–∑ —Ç–µ–∫—Å—Ç–∞
        $payload->links = $this->getLinks($payload->originalText);

        return $payload;
    }

    public function getLinks(string $text): array
    {
        // –ª–æ–≥–∏–∫–∞
        return [];
    }

    public function addClassIntoText(string $text): string
    {
        // –ª–æ–≥–∏–∫–∞
        return $text;
    }
}


namespace App\Services\TextProcess\Handlers;

use App\Services\TextProcess\TextPayload;
use App\Services\TextProcess\TextProcessorHandler;

final class BreakTextIntoBlocks implements TextProcessorHandler
{
    public function handle(TextPayload $payload): TextPayload
    {
        $text = $payload->originalText;

        $payload->blocks = $this->run($text);

        return $payload;
    }

    // –∑–¥–µ—Å—å –ª–æ–≥–∏–∫–∞ –ø–æ —Ä–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –±–ª–æ–∫–∏ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∏—Ö
    public function run(string $text): array
    {
        return [];
    }
}
```

*Pipeline*

```php
namespace App\Services\TextProcess;

final class TextProcessingPipeline
{
    private array $handlers = [];

    public function addHandler(TextProcessorHandler $handler): self
    {
        $this->handlers[] = $handler;
        return $this;
    }

    public function process(TextPayload $payload): TextPayload
    {
        foreach ($this->handlers as $handler) {
            $payload = $handler->handle($payload);
        }

        return $payload;
    }
}
```

*–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ*

```php
$pipeline = new TextProcessingPipeline();
$pipeline
    ->addHandler(new GetLinks())
    ->addHandler(new BreakTextIntoBlocks());

$text = "&lt;h2&gt;Title&lt;/h2&gt;";
$payload = new TextPayload($text);

$result = $pipeline->process($payload);
```

#### –†–µ–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
* üîπ	–û—á–∏—Å—Ç–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
* üîπ	–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π).
* üîπ	–°–æ–∑–¥–∞–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤ –∏–ª–∏ —Å–æ–±—ã—Ç–∏–π. 
* üîπ	–û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ –∏—Ö —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º.