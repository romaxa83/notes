#docker

*`Dockerfile` ‚Äì —ç—Ç–æ –æ–±—ã—á–Ω—ã–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –Ω–∞–±–æ—Ä –æ–ø–µ—Ä–∞—Ü–∏–π (–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π), –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è —Å–±–æ—Ä–∫–∏ Docker-–æ–±—Ä–∞–∑–∞.*

### üîπ –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏

###### üî∏FROM

–ó–∞–¥–∞—ë—Ç –±–∞–∑–æ–≤—ã–π –æ–±—Ä–∞–∑, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ —Å—Ç—Ä–æ–∏—Ç—Å—è –≤–∞—à –æ–±—Ä–∞–∑. –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –Ω–∞—á–∞–ª–µ Dockerfile (–∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º ARG, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –¥–æ FROM)

```Dockerfile
FROM php:8.1-fpm
```

> –•–æ—Ä–æ—à–µ–π –ø—Ä–∞–∫—Ç–∏–∫–æ–π —è–≤–ª—è–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö —Ç–µ–≥–æ–≤ –≤–º–µ—Å—Ç–æ latest
---
###### üî∏ RUN
 
–í—ã–ø–æ–ª–Ω—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ –∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—ã–π —Å–ª–æ–π. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–∞–∫–µ—Ç–æ–≤, –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –∫–æ–¥–∞ –∏ —Ç.–¥. –í–∞–∂–Ω–æ  –æ–±—ä–µ–¥–∏–Ω—è–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã —á–µ—Ä–µ–∑ `&&` –∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `\` –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Å–ª–æ–µ–≤ –≤ –æ–±—Ä–∞–∑–µ. 

```Dockerfile
RUN apt-get update && apt-get install -y \  
    git \  
    zip \  
    unzip
```

> –≤—Å–µ –∫–æ–º–∞–Ω–¥—ã –∏—Å–ø–æ–ª–Ω—è—é—Ç—Å—è —Å –ø–æ–ª–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
---
###### üî∏COPY –∏ ADD

–ö–æ–ø–∏—Ä—É–µ—Ç (–¥–æ–±–∞–≤–ª—è–µ—Ç) —Ñ–∞–π–ª—ã –∏–∑ —Ö–æ—Å—Ç–∞ –≤ –æ–±—Ä–∞–∑. `COPY` –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π, –∞ `ADD`: –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Ä–∞—Å–ø–∞–∫–æ–≤–∞—Ç—å –∞—Ä—Ö–∏–≤ –∏–ª–∏ —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –ø–æ URL

```Dockerfile
COPY . /var/www/html  
ADD https://example.com/file.tar.gz /tmp/
```

>  –ü—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å COPY, –∫–æ–≥–¥–∞ –Ω–µ –Ω—É–∂–Ω–∞ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å ADD
---
###### üî∏WORKDIR

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Ä–∞–±–æ—á—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è —Å–ª–µ–¥—É—é—â–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –ø—É—Ç–µ–π –∏ —Å–¥–µ–ª–∞—Ç—å Dockerfile —á–∏—â–µ

```Dockerfile
WORKDIR /var/www/html
```

> –°–æ–∑–¥–∞–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
---
###### üî∏ENV

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏–ª–∏ —É–∫–∞–∑–∞–Ω–∏—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π

```Dockerfile
ENV APP_ENV=production
```

> –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–æ—Å—Ç—É–ø–Ω—ã –∏ –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏, –∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
---
###### üî∏ARG

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–æ–ª—å–∫–æ –≤–æ –≤—Ä–µ–º—è —Å–±–æ—Ä–∫–∏. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å–±–æ—Ä–∫–∏

```Dockerfile
ARG PHP_VERSION=8.1
```

> –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ **–ù–ï** –¥–æ—Å—Ç—É–ø–Ω—ã –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
---
###### üî∏EXPOSE

–î–æ–∫—É–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –ø–æ—Ä—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–µ—Ç. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è - –∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –æ —Å–µ—Ä–≤–∏—Å–∞—Ö, —Ä–∞–±–æ—Ç–∞—é—â–∏—Ö –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ

```Dockerfile
EXPOSE 80
```

> –ù–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –ø–æ—Ä—Ç—ã, –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å -p –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
---
###### üî∏CMD –∏ ENTRYPOINT

`ENTRYPOINT` - –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –æ–Ω–∞ –∑–∞–¥–∞–µ—Ç –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä–∞—è —è–≤–ª—è–µ—Ç—Å—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–π –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –∏ –µ—ë –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å (–±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤)

`CMD` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –ø–µ—Ä–µ–¥–∞–Ω—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–æ–π –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è `ENTRYPOINT`. –ï—Å–ª–∏ `CMD` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ `Dockerfile`, –Ω–æ –∫–æ–º–∞–Ω–¥–∞ –Ω–µ –±—ã–ª–∞ —É–∫–∞–∑–∞–Ω–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, —Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ–º–∞–Ω–¥–∞ –∏–∑ `CMD`. –û–Ω —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞.

–ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–±–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤–º–µ—Å—Ç–µ, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∑–∞–¥–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—É—é –∫–æ–º–∞–Ω–¥—É —á–µ—Ä–µ–∑ `ENTRYPOINT`, –∞ `CMD` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è —É–∫–∞–∑–∞–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.

```Dockerfile
ENTRYPOINT ["php", "artisan"]  
CMD ["serve", "--host=0.0.0.0"]
```

> –í `Dockerfile` –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω `CMD` , –æ–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `CMD` –¥–ª—è –∫–æ–º–∞–Ω–¥, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ, –∞ `ENTRYPOINT` –¥–ª—è –∫–æ–º–∞–Ω–¥, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –≤—Å–µ–≥–¥–∞
---
###### üî∏VOLUME

–°–æ–∑–¥–∞–µ—Ç —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –≤–Ω–µ—à–Ω–µ–≥–æ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –¥–∞–Ω–Ω—ã–µ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

```Dockerfile
VOLUME /var/www/html/storage
```

> –î–∞–Ω–Ω—ã–µ –≤ –æ–±—ä—è–≤–ª–µ–Ω–Ω—ã—Ö —Ç–æ–º–∞—Ö **–ù–ï** –≤–∫–ª—é—á–∞—é—Ç—Å—è –≤ –æ–±—Ä–∞–∑
---
###### üî∏USER

–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –∏ –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (**–Ω–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –∫–∞–∫ root**)

```Dockerfile
USER www-data
```

> –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –æ–±—Ä–∞–∑–µ
---
###### üî∏HEALTHCHECK

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫–∞–∫ Docker –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –Ω—É–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ—Å–ª–∏ –Ω—É–∂–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```Dockerfile
HEALTHCHECK --interval=5m CMD curl -f http://localhost/ || exit 1
```
---
### üîπ  –í–∞–∂–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

###### üî∏–ú–Ω–æ–≥–æ—ç—Ç–∞–ø–Ω–∞—è —Å–±–æ—Ä–∫–∞

–ò—Å–ø–æ–ª—å–∑—É–µ–º –¥–ª—è —É–º–µ–Ω—å—à–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∏—Ç–æ–≥–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞

```Dockerfile
FROM composer:2 as vendor  
WORKDIR /app  
COPY composer.json composer.lock ./  
RUN composer install --no-dev --no-scripts  
  
FROM php:8.1-fpm  
COPY --from=vendor /app/vendor /var/www/html/vendor
```
---
###### üî∏ –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ—ë–≤

Docker –∫—ç—à–∏—Ä—É–µ—Ç –∫–∞–∂–¥—ã–π —Å–ª–æ–π, –∏–∑–º–µ–Ω–µ–Ω–∏–µ —Å–ª–æ—è –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç –≤—Å–µ –ø–æ—Å–ª–µ–¥—É—é—â–∏–µ –ø–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ —Ä–∞–∑–º–µ—â–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –æ—Ç –Ω–∞–∏–±–æ–ª–µ–µ —Å—Ç–∞–±–∏–ª—å–Ω—ã—Ö –∫ –Ω–∞–∏–±–æ–ª–µ–µ –∏–∑–º–µ–Ω—á–∏–≤—ã–º

```Dockerfile
# –°–Ω–∞—á–∞–ª–∞ –∫–æ–ø–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π  
COPY composer.json composer.lock ./  
RUN composer install  
  
# –ó–∞—Ç–µ–º –∫–æ–ø–∏—Ä—É–µ–º –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥  
COPY . .
```
---
###### üî∏ .dockerignore

–£–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –Ω—É–∂–Ω–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç —Å–±–æ—Ä–∫–∏ —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É–º–µ–Ω—å—à–∏—Ç—å —Ä–∞–∑–º–µ—Ä –æ–±—Ä–∞–∑–∞ –∏ —É—Å–∫–æ—Ä–∏—Ç—å —Å–±–æ—Ä–∫—É

```.dockerignore
node_modules  
vendor  
.git  
.env
```
---
###### üî∏ –°–æ–≤–µ—Ç—ã –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

- –ù–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ Dockerfile (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Docker secrets –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ)
- –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–∑—ã –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (Docker Scout, Trivy)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–π—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
---
###### üî∏ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Ä–∞–∑–º–µ—Ä–∞

- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–µ –±–∞–∑–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã (alpine)
- –û—á–∏—â–∞–π—Ç–µ –∫—ç—à–∏ –ø–∞–∫–µ—Ç–Ω—ã—Ö –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤

```Dockerfile
RUN apt-get update && apt-get install -y \  
    package1 package2 && \  
    apt-get clean && \  
    rm -rf /var/lib/apt/lists/*
```
---
