#grafana #monitor

##### üîπ –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–≤—è–∑—å c prometheus:

-  –ó–∞–π–¥–∏—Ç–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Grafana (localhost:3000).
-  –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤¬†**Connections**¬†->¬†**Data Sources**.
-  –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –≤–∞—à¬†**Prometheus**.
-  –ü—Ä–æ–ª–∏—Å—Ç–∞–π—Ç–µ –≤–Ω–∏–∑ –∏ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É¬†**"Save & Test"**.
    - –ï—Å–ª–∏ –Ω–∞–ø–∏—à–µ—Ç¬†**"Data source is working"**¬†‚Äî –≤—Å—ë –æ–∫.
    - –ï—Å–ª–∏¬†**"HTTP Error Bad Gateway"**¬†‚Äî Grafana –Ω–µ –≤–∏–¥–∏—Ç —Ö–æ—Å—Ç (–ø—Ä–æ–±–ª–µ–º–∞ –≤ –∏–º–µ–Ω–∞—Ö/—Å–µ—Ç—è—Ö).
    - –ï—Å–ª–∏¬†**"Connection Refused"**¬†‚Äî Prometheus –Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ —É–ø–∞–ª.

##### üîπ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –µ—Å—Ç—å –ª–∏ –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ –ø—Ä–æ–∫–∏–Ω—É—Ç—ã–º –¥–∞—à–±–æ—Ä–¥–∞–º

==–ø—Ä–æ–≤–µ—Ä—è–µ–º –ª–æ–≥–∏==
```bash
docker logs grafana_container_name | grep -i "dashboards"
```

- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ¬†`Failed to assign uid`, –∑–Ω–∞—á–∏—Ç –≤ JSON —Ñ–∞–π–ª–µ –¥–∞—à–±–æ—Ä–¥–∞ –µ—Å—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç ID.
- –ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ¬†`folder not found`, –∑–Ω–∞—á–∏—Ç –ø—É—Ç—å –≤ YAML-—Ñ–∞–π–ª–µ –≤ —Å–µ–∫—Ü–∏–∏¬†`path`¬†—É–∫–∞–∑–∞–Ω –Ω–µ–≤–µ—Ä–Ω–æ.

##### üîπ –î–∞—à–±–æ–∞—Ä–¥ –¥–ª—è fastapi
–ß—Ç–æ–±—ã –Ω–µ —Ä–∏—Å–æ–≤–∞—Ç—å –≥—Ä–∞—Ñ–∏–∫–∏ –≤—Ä—É—á–Ω—É—é, –∏–º–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥ –¥–ª—è —ç—Ç–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏. –ù–∞–∂–º–∏—Ç–µ¬†`Dashboards`¬†->¬†`New`¬†->¬†`Import`¬†–∏ –≤–≤–µ–¥–∏—Ç–µ ID:¬†**16110**¬†(—ç—Ç–æ –ø–æ–ø—É–ª—è—Ä–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ –¥–ª—è FastAPI Instrumentator)

##### üîπ –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ –≤ `postgres_exporter`

–î–ª—è —Å–∞–º–æ–≥–æ –ø–æ–ø—É–ª—è—Ä–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞¬†**`prometheuscommunity/postgres-exporter`**¬†(–∫–æ—Ç–æ—Ä—ã–π –≤—ã –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ) "–∑–æ–ª–æ—Ç—ã–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º" —è–≤–ª—è–µ—Ç—Å—è:

1. –°–∞–º—ã–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–π –∏ –ø–æ–ª–Ω—ã–π –¥–∞—à–±–æ—Ä–¥

- **–ù–∞–∑–≤–∞–Ω–∏–µ:**¬†**PostgreSQL Database**
- **ID –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:**¬†**`9628`**
- **–ß—Ç–æ –≤–Ω—É—Ç—Ä–∏:**¬†–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏, Locks (–±–ª–æ–∫–∏—Ä–æ–≤–∫–∏), –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫—ç—à–∞ (Buffer Cache Hit Ratio), —Ä–∞–∑–º–µ—Ä—ã —Ç–∞–±–ª–∏—Ü/–∏–Ω–¥–µ–∫—Å–æ–≤, –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.

==–ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤==
```bash
docker logs postgres_exporter_container_name | grep pg_static
```

##### üîπ –ï—Å–ø–æ—Ä—Ç–µ—Ä –∏ –¥–∞—à–±–æ–∞—Ä–¥ –¥–ª—è RabbitMQ

–ï—Å–ª–∏ —É –≤–∞—Å RabbitMQ –≤–µ—Ä—Å–∏–∏ 3.8+, —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä —É–∂–µ —Ç–∞–º. –ï–≥–æ –Ω—É–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –≤–∫–ª—é—á–∏—Ç—å
```yaml
  rabbitmq:
    image: rabbitmq:3.13-management # –∏–ª–∏ –ª—é–±–∞—è –≤–µ—Ä—Å–∏—è –≤—ã—à–µ 3.8
    container_name: ${APP_NAME}__rabbitmq
    ports:
      - "5672:5672"   # AMQP
      - "15672:15672" # Management UI
      - "15692:15692" # –≠–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è Prometheus (–≤–∞–∂–Ω–æ!)
    environment:
      - RABBITMQ_DEFAULT_USER=${RABBIT_USER}
      - RABBITMQ_DEFAULT_PASS=${RABBIT_PASS}
    # –í–∫–ª—é—á–∞–µ–º –ø–ª–∞–≥–∏–Ω –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    command: >
      sh -c "rabbitmq-plugins enable rabbitmq_prometheus && rabbitmq-server"
    healthcheck:
      test: ["CMD", "rabbitmq-diagnostics", "check_running"]
      interval: 10s
      timeout: 5s
      retries: 3
```

==–î–æ–±–∞–≤—å—Ç–µ –≤¬†prometheus.yml==
```yml
  - job_name: 'rabbitmq'
    static_configs:
      - targets: ['rabbitmq:15692'] # –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Ä—Ç 15692
```

==–î–∞—à–±–æ—Ä–¥ –¥–ª—è Grafana==
- **ID –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:**¬†**`10991`**¬†(–¥–ª—è –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–≥–æ –ø–ª–∞–≥–∏–Ω–∞) –∏–ª–∏¬†**`4279`**¬†(–¥–ª—è –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞).
- **–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º:**¬†–∑–∞—Ö–æ–¥–∏–º –≤¬†`Explore`, –∏—â–µ–º –º–µ—Ç—Ä–∏–∫–∏¬†`rabbitmq_build_info`¬†(–¥–ª—è –ø–ª–∞–≥–∏–Ω–∞) –∏–ª–∏¬†`rabbitmq_up`¬†(–¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–µ—Ä–∞)

==–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –º–µ—Ç—Ä–∏–∫–∏ –∏–¥—É—Ç==
```bash
curl http://localhost:15692/metrics
```
–ï—Å–ª–∏ –≤—ã –≤–∏–¥–∏—Ç–µ –±–æ–ª—å—à–æ–π —Å–ø–∏—Å–æ–∫ –º–µ—Ç—Ä–∏–∫, –Ω–∞—á–∏–Ω–∞—é—â–∏—Ö—Å—è –Ω–∞¬†`rabbitmq_`, –∑–Ω–∞—á–∏—Ç –≤—Å—ë –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤–µ—Ä–Ω–æ –∏ Prometheus –∏—Ö –∑–∞–±–µ—Ä–µ—Ç.

---
##### üîπ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ

- –°–Ω–∞—á–∞–ª–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∏–Ω—Å—Ç–∞–ª—è—Ç–æ—Ä (—Å–∞–º—É –≥—Ä–∞—Ñ–∞–Ω—É –Ω–µ —Å—Ç–∞–≤–∏–º) - https://grafana.com/docs/grafana/latest/setup-grafana/installation/debian
- –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≥—Ä–∞—Ñ–∞–Ω—É –æ—Ç—Å—é–¥–∞ - https://grafana.com/grafana/download

- grafana configurations folder - `/etc/grafana/`
- grafana installation folder - `/usr/share/grafana`

–∑–¥–µ—Å—å —Å–∫—Ä–∏–ø—Ç –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ [[install_grafana_server_ubuntu]]

---